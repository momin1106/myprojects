KISSY.use("node, event, dom",function(a){"file:"===window.location.protocol||window.location.href.indexOf("local=1")>=0,window.location.href.indexOf("daily.taobao.net")>0;a.config({combine:!0}),a.ready(function(a){!function(){var b=a.one(".J_AllowIframe")&&a.one(".J_AllowIframe").val()||"";b||window.self===window.top||(window.top.location.href=window.self.location.href)}()})});KISSY.add("register/atp",function(a){var b={fire:function(b,c){if(b=a.isString(b)?b:""){var d=new Image;c=a.isPlainObject(c)||a.isString(c)?a.isPlainObject(c)?a.param(c):c:"",d.src=b+(b.indexOf("?")>=0?"&":"?")+c}}};return b});!function(a){if("function"==typeof bootstrap)bootstrap("promise",a);else if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=a}else Q=a()}(function(){"use strict";function a(a){return function(){return V.apply(a,arguments)}}function b(a){return a===Object(a)}function c(a){return"[object StopIteration]"===ba(a)||a instanceof R}function d(a,b){if(O&&b.stack&&"object"==typeof a&&null!==a&&a.stack&&-1===a.stack.indexOf(ca)){for(var c=[],d=b;d;d=d.source)d.stack&&c.unshift(d.stack);c.unshift(a.stack);var f=c.join("\n"+ca+"\n");a.stack=e(f)}}function e(a){for(var b=a.split("\n"),c=[],d=0;d<b.length;++d){var e=b[d];h(e)||f(e)||!e||c.push(e)}return c.join("\n")}function f(a){return-1!==a.indexOf("(module.js:")||-1!==a.indexOf("(node.js:")}function g(a){var b=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(a);if(b)return[b[1],Number(b[2])];var c=/at ([^ ]+):(\d+):(?:\d+)$/.exec(a);if(c)return[c[1],Number(c[2])];var d=/.*@(.+):(\d+)$/.exec(a);return d?[d[1],Number(d[2])]:void 0}function h(a){var b=g(a);if(!b)return!1;var c=b[0],d=b[1];return c===Q&&d>=S&&ga>=d}function i(){if(O)try{throw new Error}catch(a){var b=a.stack.split("\n"),c=b[0].indexOf("@")>0?b[1]:b[2],d=g(c);if(!d)return;return Q=d[0],d[1]}}function j(a,b,c){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(b+" is deprecated, use "+c+" instead.",new Error("").stack),a.apply(a,arguments)}}function k(a){return r(a)?a:s(a)?B(a):A(a)}function l(){function a(a){b=a,f.source=a,X(c,function(b,c){U(function(){a.promiseDispatch.apply(a,c)})},void 0),c=void 0,d=void 0}var b,c=[],d=[],e=$(l.prototype),f=$(o.prototype);if(f.promiseDispatch=function(a,e,f){var g=W(arguments);c?(c.push(g),"when"===e&&f[1]&&d.push(f[1])):U(function(){b.promiseDispatch.apply(b,g)})},f.valueOf=function(){if(c)return f;var a=q(b);return r(a)&&(b=a),a},f.inspect=function(){return b?b.inspect():{state:"pending"}},k.longStackSupport&&O)try{throw new Error}catch(g){f.stack=g.stack.substring(g.stack.indexOf("\n")+1)}return e.promise=f,e.resolve=function(c){b||a(k(c))},e.fulfill=function(c){b||a(A(c))},e.reject=function(c){b||a(z(c))},e.notify=function(a){b||X(d,function(b,c){U(function(){c(a)})},void 0)},e}function m(a){if("function"!=typeof a)throw new TypeError("resolver must be a function.");var b=l();try{a(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}return b.promise}function n(a){return m(function(b,c){for(var d=0,e=a.length;e>d;d++)k(a[d]).then(b,c)})}function o(a,b,c){void 0===b&&(b=function(a){return z(new Error("Promise does not support operation: "+a))}),void 0===c&&(c=function(){return{state:"unknown"}});var d=$(o.prototype);if(d.promiseDispatch=function(c,e,f){var g;try{g=a[e]?a[e].apply(d,f):b.call(d,e,f)}catch(h){g=z(h)}c&&c(g)},d.inspect=c,c){var e=c();"rejected"===e.state&&(d.exception=e.reason),d.valueOf=function(){var a=c();return"pending"===a.state||"rejected"===a.state?d:a.value}}return d}function p(a,b,c,d){return k(a).then(b,c,d)}function q(a){if(r(a)){var b=a.inspect();if("fulfilled"===b.state)return b.value}return a}function r(a){return b(a)&&"function"==typeof a.promiseDispatch&&"function"==typeof a.inspect}function s(a){return b(a)&&"function"==typeof a.then}function t(a){return r(a)&&"pending"===a.inspect().state}function u(a){return!r(a)||"fulfilled"===a.inspect().state}function v(a){return r(a)&&"rejected"===a.inspect().state}function w(){da.length=0,ea.length=0,fa||(fa=!0)}function x(a,b){fa&&(ea.push(a),b&&"undefined"!=typeof b.stack?da.push(b.stack):da.push("(no stack) "+b))}function y(a){if(fa){var b=Y(ea,a);-1!==b&&(ea.splice(b,1),da.splice(b,1))}}function z(a){var b=o({when:function(b){return b&&y(this),b?b(a):this}},function(){return this},function(){return{state:"rejected",reason:a}});return x(b,a),b}function A(a){return o({when:function(){return a},get:function(b){return a[b]},set:function(b,c){a[b]=c},"delete":function(b){delete a[b]},post:function(b,c){return null===b||void 0===b?a.apply(void 0,c):a[b].apply(a,c)},apply:function(b,c){return a.apply(b,c)},keys:function(){return aa(a)}},void 0,function(){return{state:"fulfilled",value:a}})}function B(a){var b=l();return U(function(){try{a.then(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}}),b.promise}function C(a){return o({isDef:function(){}},function(b,c){return I(a,b,c)},function(){return k(a).inspect()})}function D(a,b,c){return k(a).spread(b,c)}function E(a){return function(){function b(a,b){var g;if("undefined"==typeof StopIteration){try{g=d[a](b)}catch(h){return z(h)}return g.done?k(g.value):p(g.value,e,f)}try{g=d[a](b)}catch(h){return c(h)?k(h.value):z(h)}return p(g,e,f)}var d=a.apply(this,arguments),e=b.bind(b,"next"),f=b.bind(b,"throw");return e()}}function F(a){k.done(k.async(a)())}function G(a){throw new R(a)}function H(a){return function(){return D([this,J(arguments)],function(b,c){return a.apply(b,c)})}}function I(a,b,c){return k(a).dispatch(b,c)}function J(a){return p(a,function(a){var b=0,c=l();return X(a,function(d,e,f){var g;r(e)&&"fulfilled"===(g=e.inspect()).state?a[f]=g.value:(++b,p(e,function(d){a[f]=d,0===--b&&c.resolve(a)},c.reject,function(a){c.notify({index:f,value:a})}))},void 0),0===b&&c.resolve(a),c.promise})}function K(a){return p(a,function(a){return a=Z(a,k),p(J(Z(a,function(a){return p(a,T,T)})),function(){return a})})}function L(a){return k(a).allSettled()}function M(a,b){return k(a).then(void 0,void 0,b)}function N(a,b){return k(a).nodeify(b)}var O=!1;try{throw new Error}catch(P){O=!!P.stack}var Q,R,S=i(),T=function(){},U=function(){function a(){for(;b.next;){b=b.next;var c=b.task;b.task=void 0;var e=b.domain;e&&(b.domain=void 0,e.enter());try{c()}catch(g){if(f)throw e&&e.exit(),setTimeout(a,0),e&&e.enter(),g;setTimeout(function(){throw g},0)}e&&e.exit()}d=!1}var b={task:void 0,next:null},c=b,d=!1,e=void 0,f=!1;if(U=function(a){c=c.next={task:a,domain:f&&process.domain,next:null},d||(d=!0,e())},"undefined"!=typeof process&&process.nextTick)f=!0,e=function(){process.nextTick(a)};else if("function"==typeof setImmediate)e="undefined"!=typeof window?setImmediate.bind(window,a):function(){setImmediate(a)};else if("undefined"!=typeof MessageChannel){var g=new MessageChannel;g.port1.onmessage=function(){e=h,g.port1.onmessage=a,a()};var h=function(){g.port2.postMessage(0)};e=function(){setTimeout(a,0),h()}}else e=function(){setTimeout(a,0)};return U}(),V=Function.call,W=a(Array.prototype.slice),X=a(Array.prototype.reduce||function(a,b){var c=0,d=this.length;if(1===arguments.length)for(;;){if(c in this){b=this[c++];break}if(++c>=d)throw new TypeError}for(;d>c;c++)c in this&&(b=a(b,this[c],c));return b}),Y=a(Array.prototype.indexOf||function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1}),Z=a(Array.prototype.map||function(a,b){var c=this,d=[];return X(c,function(e,f,g){d.push(a.call(b,f,g,c))},void 0),d}),$=Object.create||function(a){function b(){}return b.prototype=a,new b},_=a(Object.prototype.hasOwnProperty),aa=Object.keys||function(a){var b=[];for(var c in a)_(a,c)&&b.push(c);return b},ba=a(Object.prototype.toString);R="undefined"!=typeof ReturnValue?ReturnValue:function(a){this.value=a};var ca="From previous event:";k.resolve=k,k.nextTick=U,k.longStackSupport=!1,k.defer=l,l.prototype.makeNodeResolver=function(){var a=this;return function(b,c){b?a.reject(b):arguments.length>2?a.resolve(W(arguments,1)):a.resolve(c)}},k.Promise=m,k.promise=m,m.race=n,m.all=J,m.reject=z,m.resolve=k,k.passByCopy=function(a){return a},o.prototype.passByCopy=function(){return this},k.join=function(a,b){return k(a).join(b)},o.prototype.join=function(a){return k([this,a]).spread(function(a,b){if(a===b)return a;throw new Error("Can't join: not the same: "+a+" "+b)})},k.race=n,o.prototype.race=function(){return this.then(k.race)},k.makePromise=o,o.prototype.toString=function(){return"[object Promise]"},o.prototype.then=function(a,b,c){function e(b){try{return"function"==typeof a?a(b):b}catch(c){return z(c)}}function f(a){if("function"==typeof b){d(a,h);try{return b(a)}catch(c){return z(c)}}return z(a)}function g(a){return"function"==typeof c?c(a):a}var h=this,i=l(),j=!1;return U(function(){h.promiseDispatch(function(a){j||(j=!0,i.resolve(e(a)))},"when",[function(a){j||(j=!0,i.resolve(f(a)))}])}),h.promiseDispatch(void 0,"when",[void 0,function(a){var b,c=!1;try{b=g(a)}catch(d){if(c=!0,!k.onerror)throw d;k.onerror(d)}c||i.notify(b)}]),i.promise},k.when=p,o.prototype.thenResolve=function(a){return this.then(function(){return a})},k.thenResolve=function(a,b){return k(a).thenResolve(b)},o.prototype.thenReject=function(a){return this.then(function(){throw a})},k.thenReject=function(a,b){return k(a).thenReject(b)},k.nearer=q,k.isPromise=r,k.isPromiseAlike=s,k.isPending=t,o.prototype.isPending=function(){return"pending"===this.inspect().state},k.isFulfilled=u,o.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},k.isRejected=v,o.prototype.isRejected=function(){return"rejected"===this.inspect().state};var da=[],ea=[],fa=!0;k.resetUnhandledRejections=w,k.getUnhandledReasons=function(){return da.slice()},k.stopUnhandledRejectionTracking=function(){w(),fa=!1},w(),k.reject=z,k.fulfill=A,k.master=C,k.spread=D,o.prototype.spread=function(a,b){return this.all().then(function(b){return a.apply(void 0,b)},b)},k.async=E,k.spawn=F,k["return"]=G,k.promised=H,k.dispatch=I,o.prototype.dispatch=function(a,b){var c=this,d=l();return U(function(){c.promiseDispatch(d.resolve,a,b)}),d.promise},k.get=function(a,b){return k(a).dispatch("get",[b])},o.prototype.get=function(a){return this.dispatch("get",[a])},k.set=function(a,b,c){return k(a).dispatch("set",[b,c])},o.prototype.set=function(a,b){return this.dispatch("set",[a,b])},k.del=k["delete"]=function(a,b){return k(a).dispatch("delete",[b])},o.prototype.del=o.prototype["delete"]=function(a){return this.dispatch("delete",[a])},k.mapply=k.post=function(a,b,c){return k(a).dispatch("post",[b,c])},o.prototype.mapply=o.prototype.post=function(a,b){return this.dispatch("post",[a,b])},k.send=k.mcall=k.invoke=function(a,b){return k(a).dispatch("post",[b,W(arguments,2)])},o.prototype.send=o.prototype.mcall=o.prototype.invoke=function(a){return this.dispatch("post",[a,W(arguments,1)])},k.fapply=function(a,b){return k(a).dispatch("apply",[void 0,b])},o.prototype.fapply=function(a){return this.dispatch("apply",[void 0,a])},k["try"]=k.fcall=function(a){return k(a).dispatch("apply",[void 0,W(arguments,1)])},o.prototype.fcall=function(){return this.dispatch("apply",[void 0,W(arguments)])},k.fbind=function(a){var b=k(a),c=W(arguments,1);return function(){return b.dispatch("apply",[this,c.concat(W(arguments))])}},o.prototype.fbind=function(){var a=this,b=W(arguments);return function(){return a.dispatch("apply",[this,b.concat(W(arguments))])}},k.keys=function(a){return k(a).dispatch("keys",[])},o.prototype.keys=function(){return this.dispatch("keys",[])},k.all=J,o.prototype.all=function(){return J(this)},k.allResolved=j(K,"allResolved","allSettled"),o.prototype.allResolved=function(){return K(this)},k.allSettled=L,o.prototype.allSettled=function(){return this.then(function(a){return J(Z(a,function(a){function b(){return a.inspect()}return a=k(a),a.then(b,b)}))})},k.fail=k["catch"]=function(a,b){return k(a).then(void 0,b)},o.prototype.fail=o.prototype["catch"]=function(a){return this.then(void 0,a)},k.progress=M,o.prototype.progress=function(a){return this.then(void 0,void 0,a)},k.fin=k["finally"]=function(a,b){return k(a)["finally"](b)},o.prototype.fin=o.prototype["finally"]=function(a){return a=k(a),this.then(function(b){return a.fcall().then(function(){return b})},function(b){return a.fcall().then(function(){throw b})})},k.done=function(a,b,c,d){return k(a).done(b,c,d)},o.prototype.done=function(a,b,c){var e=function(a){U(function(){if(d(a,f),!k.onerror)throw a;k.onerror(a)})},f=a||b||c?this.then(a,b,c):this;"object"==typeof process&&process&&process.domain&&(e=process.domain.bind(e)),f.then(void 0,e)},k.timeout=function(a,b,c){return k(a).timeout(b,c)},o.prototype.timeout=function(a,b){var c=l(),d=setTimeout(function(){b&&"string"!=typeof b||(b=new Error(b||"Timed out after "+a+" ms"),b.code="ETIMEDOUT"),c.reject(b)},a);return this.then(function(a){clearTimeout(d),c.resolve(a)},function(a){clearTimeout(d),c.reject(a)},c.notify),c.promise},k.delay=function(a,b){return void 0===b&&(b=a,a=void 0),k(a).delay(b)},o.prototype.delay=function(a){return this.then(function(b){var c=l();return setTimeout(function(){c.resolve(b)},a),c.promise})},k.nfapply=function(a,b){return k(a).nfapply(b)},o.prototype.nfapply=function(a){var b=l(),c=W(a);return c.push(b.makeNodeResolver()),this.fapply(c).fail(b.reject),b.promise},k.nfcall=function(a){var b=W(arguments,1);return k(a).nfapply(b)},o.prototype.nfcall=function(){var a=W(arguments),b=l();return a.push(b.makeNodeResolver()),this.fapply(a).fail(b.reject),b.promise},k.nfbind=k.denodeify=function(a){var b=W(arguments,1);return function(){var c=b.concat(W(arguments)),d=l();return c.push(d.makeNodeResolver()),k(a).fapply(c).fail(d.reject),d.promise}},o.prototype.nfbind=o.prototype.denodeify=function(){var a=W(arguments);return a.unshift(this),k.denodeify.apply(void 0,a)},k.nbind=function(a,b){var c=W(arguments,2);return function(){function d(){return a.apply(b,arguments)}var e=c.concat(W(arguments)),f=l();return e.push(f.makeNodeResolver()),k(d).fapply(e).fail(f.reject),f.promise}},o.prototype.nbind=function(){var a=W(arguments,0);return a.unshift(this),k.nbind.apply(void 0,a)},k.nmapply=k.npost=function(a,b,c){return k(a).npost(b,c)},o.prototype.nmapply=o.prototype.npost=function(a,b){var c=W(b||[]),d=l();return c.push(d.makeNodeResolver()),this.dispatch("post",[a,c]).fail(d.reject),d.promise},k.nsend=k.nmcall=k.ninvoke=function(a,b){var c=W(arguments,2),d=l();return c.push(d.makeNodeResolver()),k(a).dispatch("post",[b,c]).fail(d.reject),d.promise},o.prototype.nsend=o.prototype.nmcall=o.prototype.ninvoke=function(a){var b=W(arguments,1),c=l();return b.push(c.makeNodeResolver()),this.dispatch("post",[a,b]).fail(c.reject),c.promise},k.nodeify=N,o.prototype.nodeify=function(a){return a?void this.then(function(b){U(function(){a(null,b)})},function(b){U(function(){a(b)})}):this};var ga=i();return k});KISSY.add("register/components/xerror",function(a){var b=function(a,c){return this instanceof b?(this.code=a,void(this.message=c)):new b(a,c)};return b});KISSY.add("register/components/message",function(a){var b=window.TRLang||{},c={info:"&#xf0142;",help:"&#xf0143;",warn:"&#xf001b;",error:"&#xf0155;",ok:"&#xf0156;"},d=(a.require("event"),a.require("dom")),e=function(b){return this instanceof e?(b=b||{},this.el=b.el&&a.all(b.el),this.offsetEl=b.offsetEl&&a.one(b.offsetEl),this.offset=a.isObject(b.offset)?b.offset:{},this.offset.left=this.offset.left||0,this.offset.top=this.offset.top||0,this.zindex=b.zindex,this.width=b.width,this.contentHTML=this.el&&this.el.html(),void this._init()):new e(b)};return a.augment(e,{_init:function(){if(this.el){this.setType(this.el.attr("data-type")),this.initDisplay(),this._initDom(),this.shown()&&this.show();var b=this;a.all(window).on("resize",function(){b.fixed()})}},_initDom:function(){this.el.html(""),this.icon||(this.icon=a.one(d.create('<i class="iconfont">'+c[this.getType()]+"</i>")),this.el.append(this.icon)),this.title||(this.title=a.one(d.create('<div class="msg-tit"></div>')),this.el.append(this.title)),this.content||(this.content=a.one(d.create('<div class="msg-cnt" aria-live="assertive">'+this.contentHTML+"</div>")),this.el.append(this.content)),this.offsetEl&&a.all("body").append(this.el)},getType:function(){var a=this.el.attr("class").match(/\bmsg\-type\-(info|help|warn|error|ok)\b/);return a?a[1]:""},setType:function(a){if(a&&c[a]){var b=this.getType();return b?this.el.replaceClass("msg-type-"+b,"msg-type-"+a):this.el.addClass("msg-type-"+a),this.setIcon(a),this}},setIcon:function(a){return this.icon&&this.icon.html(c[a]||""),this},setTitle:function(a){return this.title&&this.title.html(a),this},setContent:function(a){return this.content&&this.content.html(a),this},getDisplay:function(){return this.el.attr("data-display")||"block"},initDisplay:function(){this.el.attr("data-display",this.getDisplay())},setDisplay:function(a){if(a){var b=this.getDisplay();return b&&b!==a&&this.el.removeClass("msg-display-"+b),this.el.addClass("msg-display-"+a),this.el.attr("data-display",a),this}},set:function(b){return b=a.isObject(b)?b:{content:b},this.setTitle(b.title||""),this.setContent(b.content||""),b.type&&this.setType(b.type),b.display&&this.setDisplay(b.display),this},shown:function(){return"1"===this.el.attr("data-show")},show:function(){var b=this.getDisplay()||"block";return this.el.removeClass("msg-hide"),this.setDisplay(b),this.el.attr("data-show",1),a.isNumber(this.zindex)&&this.el.css({"z-index":this.zindex}),a.isNumber(this.width)&&this.el.css({width:this.width}),this.fixed(),this},showPlaceHolder:function(c){var d=c.el&&a.one(c.el),e=d&&d.attr("data-outer_placeholder");e&&b[e]&&(c.content=b[e],this.set(c).show())},hide:function(){return this.el.addClass("msg-hide"),this.el.attr("data-show",0),this},hideIfNotOk:function(){"ok"!==this.getType()&&this.hide()},fixed:function(){if(this.offsetEl){var a=this.offsetEl?this.offsetEl.offset():{left:0,top:0};a.left=a.left+(this.offsetEl&&this.offsetEl.outerWidth()),this.el.css({position:"absolute",left:a.left+this.offset.left+3,top:a.top+this.offset.top})}}}),e},{requires:["dom","node","event"]});KISSY.add("register/components/email",function(a){var b=(a.require("event"),a.require("register/components/xerror")),c=window.TRLang||{},d={EMAIL_EMPTY:c.ERROR_GENERAL_EMAIL_EMPTY||"请输入你的邮箱",EMAIL_TOO_LONG:c.ERROR_GENERAL_EMAIL_MALFORM_TOO_LONG||"邮箱格式不正确，请重新输入",EMAIL_INVALID:c.ERROR_GENERAL_EMAIL_MALFORM||"邮箱格式不正确，请重新输入"},e=function(b){return this instanceof e?(b=b||{},this.elEmail=b.elEmail&&a.one(b.elEmail),void this._init()):new e(b)};return a.augment(e,{pattern:/^[a-zA-Z\d][-\.\w]*@(?:[-\w]+\.)+(?:[a-zA-Z])+$/,_init:function(){!this.elEmail},validate:function(){var a,c=Q.defer(),e=this.elEmail.val();return e?e.length>60?a="EMAIL_TOO_LONG":this.pattern.test(e)||(a="EMAIL_INVALID"):a="EMAIL_EMPTY",a?c.reject(new b(a,d[a])):c.resolve(),c.promise}}),e},{requires:["event","register/components/xerror"]});KISSY.add("register/components/passwordrule",function(){return{regex:{illegal:/[^-+=|,0-9a-zA-Z!@#$%^&*?_.~+\/\\(){}\[\]<>]/,allNumber:/^\d+$/,allLetter:/^[a-zA-Z]+$/,allCharacter:/^[-+=|,!@#$%^&*?_.~+\/\\(){}\[\]<>]+$/,allSame:/^([\s\S])\1*$/,upperLetter:/[A-Z]/,lowerLetter:/[a-z]/,number:/\d/g,character:/[-+=|,!@#$%^&*?_.~+\/\\()|{}\[\]<>]/},score:function(a){var b=0;if(this.isIllegal(a))return b;var c=this.size(a);4>=c?b+=5:c>4&&8>c?b+=10:c>=8&&(b+=25);var d=this.hasLowerAndUpperLetter(a),e=this.hasLetter(a);d?b+=20:e&&(b+=10);var f=this.hasNumber(a);f>=3?b+=20:f&&(b+=10);var g=this.hasCharacter(a);return g>=3?b+=25:g&&(b+=10),d&&f&&g?b+=10:e&&f&&g?b+=5:(e&&f||e&&g||f&&g)&&(b+=2),b},level:function(a){return Math.floor(this.score(a)/10)},size:function(a){return a.length},isIllegal:function(a){return!!a.match(this.regex.illegal)},isAllNumber:function(a){return!!a.match(this.regex.allNumber)},isAllLetter:function(a){return!!a.match(this.regex.allLetter)},isAllSame:function(a){return!!a.match(this.regex.allSame)},hasNumber:function(a){return(a.match(this.regex.number)||[]).length},hasLetter:function(a){return!!a.match(this.regex.lowerLetter)||!!a.match(this.regex.upperLetter)},hasLowerAndUpperLetter:function(a){return!!a.match(this.regex.lowerLetter)&&!!a.match(this.regex.upperLetter)},hasNumberAndLetter:function(a){return!(!a.match(this.regex.number)||!a.match(this.regex.lowerLetter)&&!a.match(this.regexp.upperLetter))},hasCharacter:function(a){return(a.match(this.regex.character)||[]).length}}});KISSY.add("register/components/passwordtip",function(a){var b=a.require("event"),c=(a.require("dom"),window.TRLang||{}),d={low:c.pwd_level_low||"低",medium:c.pwd_level_medium||"中",high:c.pwd_level_high||"高"},e={ok:"&#x3447;",error:"&#x3432;",normal:"&#xe611;"},f=function(b){return this instanceof f?(b=b||{},this.refEl=b.refEl&&a.one(b.refEl),this.offset=a.isObject(b.offset)?b.offset:{},this.offset.left=this.offset.left||0,this.offset.top=this.offset.top||0,void this._init()):new f(b)};return a.augment(f,b.Target,{_init:function(){},_create:function(){this._CREATED||(this._CREATED=!0,this.el=a.all("#J_PwdTip"),a.one("body").append(this.el))},show:function(){var a=this.refEl.offset();this._create(),this.el.show().css({position:"absolute",left:a.left+this.offset.left,top:a.top-this.el.height()/2+this.offset.top})},hide:function(){this.el.hide()},update:function(b){for(var c in b)this.updateItem(c,b[c]);a.all(".pw-strength-bar").attr({"class":"pw-strength-bar pw-strength-bar-"+b.strength}).all("em").html([d.low,d.medium,d.high][b.strength-1])},updateItem:function(b,c){var d,c=c===!0?"ok":c===!1?"error":"normal",f=e[c];switch(b){case"length":d=a.all(".pw-rule-length");break;case"legal":d=a.all(".pw-rule-legal");break;case"multi":d=a.all(".pw-rule-multi")}d&&d.all(".iconfont").attr({"class":"iconfont pw-icon-"+c}).html(f)},reset:function(){this.updateItem("length"),this.updateItem("legal"),this.updateItem("multi"),a.all(".pw-strength-bar").attr({"class":"pw-strength-bar"}).all("em").html("")}}),f},{requires:["event","dom"]});KISSY.add("register/components/repassword",function(a){var b=a.require("event"),c=a.require("register/components/xerror"),d=window.TRLang||{},e=function(b){return this instanceof e?(b=b||{},this.elPassword=b.elPassword&&a.one(b.elPassword),this.elRePassword=b.elRePassword&&a.one(b.elRePassword),void this._init()):new e(b)};return a.augment(e,b.Target,{_init:function(){},validate:function(){var a=Q.defer();return this.elPassword.val()!==this.elRePassword.val()?a.reject(new c("RePasswordInvalid",d.ERROR_GENERAL_CONFIRM_PASSWORD_NOT_MATCH||"密码输入不一致")):a.resolve(),a.promise}}),e},{requires:["event","register/components/xerror"]});KISSY.add("register/components/password",function(a){var b=a.require("event"),c=a.require("register/components/passwordrule"),d=a.require("register/components/passwordtip"),e=a.require("register/components/xerror"),f=window.TRLang||{},g=function(b){return this instanceof g?(b=b||{},this.el=b.el&&a.one(b.el),void this._init()):new g(b)};return a.augment(g,b.Target,{_init:function(){this.el&&(this.tip=d({refEl:this.el,offset:{left:this.el.width()+22,top:this.el.height()/2+8}}))},check:function(){var a=this.el.val(),b={length:c.size(a)>=6&&c.size(a)<=20,legal:!c.isIllegal(a),multi:!!(c.hasNumber(a)&&c.hasLetter(a)||c.hasNumber(a)&&c.hasCharacter(a)||c.hasLetter(a)&&c.hasCharacter(a)),strength:this.strength()};return b},validate:function(){var a=Q.defer(),b=this.check();return b.length&&b.legal&&b.multi?a.resolve(b):a.reject(new e("PasswordInvalid",f.ERROR_MALFORM_PASSWORD||"密码设置不符合要求")),a.promise},strength:function(){var a=this.el.val(),b=c.level(a);return b>=8?3:b>=3?2:1},strengthText:function(){var a=(this.el.val(),{3:"#22a43a",2:"#ff7d1b",1:"#ff1e01"}),b={3:f.pwd_level_high||"高",2:f.pwd_level_medium||"中",1:f.pwd_level_low||"低"},c=this.strength();return'<span style="color:'+a[c]+'">'+b[c]+"</span>"},showTip:function(){this.tip.show()},hideTip:function(){this.tip.hide()},updateTip:function(){this.tip.update(this.check())},resetTip:function(){this.tip.reset()}}),g},{requires:["event","register/components/passwordrule","register/components/passwordtip","register/components/xerror"]});KISSY.add("register/components/password",function(a){var b=a.require("event"),c=a.require("register/components/passwordrule"),d=a.require("register/components/passwordtip"),e=a.require("register/components/xerror"),f=window.TRLang||{},g=function(b){return this instanceof g?(b=b||{},this.el=b.el&&a.one(b.el),void this._init()):new g(b)};return a.augment(g,b.Target,{_init:function(){this.el&&(this.tip=d({refEl:this.el,offset:{left:this.el.width()+22,top:this.el.height()/2+8}}))},check:function(){var a=this.el.val(),b={length:c.size(a)>=6&&c.size(a)<=20,legal:!c.isIllegal(a),multi:!!(c.hasNumber(a)&&c.hasLetter(a)||c.hasNumber(a)&&c.hasCharacter(a)||c.hasLetter(a)&&c.hasCharacter(a)),strength:this.strength()};return b},validate:function(){var a=Q.defer(),b=this.check();return b.length&&b.legal&&b.multi?a.resolve(b):a.reject(new e("PasswordInvalid",f.ERROR_MALFORM_PASSWORD||"密码设置不符合要求")),a.promise},strength:function(){var a=this.el.val(),b=c.level(a);return b>=8?3:b>=3?2:1},strengthText:function(){var a=(this.el.val(),{3:"#22a43a",2:"#ff7d1b",1:"#ff1e01"}),b={3:f.pwd_level_high||"高",2:f.pwd_level_medium||"中",1:f.pwd_level_low||"低"},c=this.strength();return'<span style="color:'+a[c]+'">'+b[c]+"</span>"},showTip:function(){this.tip.show()},hideTip:function(){this.tip.hide()},updateTip:function(){this.tip.update(this.check())},resetTip:function(){this.tip.reset()}}),g},{requires:["event","register/components/passwordrule","register/components/passwordtip","register/components/xerror"]});KISSY.add("register/components/nicksize",function(a){var b=a.require("event"),c=function(b){return this instanceof c?(b=b||{},this.el=b.el&&a.one(b.el),this.container=b.container&&a.one(b.container),void this._init()):new c(b)};return a.augment(c,b.Target,{_init:function(){if(this.el&&this.container){this.template=this.container.html();var a=this;this.update(),this.el.on("valuechange",function(){a.update()})}},update:function(){var b=this.el.val();return b?void this.container.css("visibility","visible").html(a.substitute(this.template,{size:this.size(b)})):void this.container.css("visibility","hidden")},size:function(a){var b=a.replace(/[^\x00-\xff]/g,"**");return b.length}}),c},{requires:["event"]});KISSY.add("register/components/nick",function(a){var b=a.require("event"),c=a.require("io"),d=a.require("menu");XError=a.require("register/components/xerror");var e=window.TRConfig||{},f=window.TRLang||{},g={NICK_LENGTH_INVALID:f.ERROR_MALFORM_NICK_NAME||"5-25个字符，一个汉字为两个字符",NICK_ILLEGAL:f.ERROR_MALFORM_NICK_NAME_INVALID_CHARACTER||"包含非法字符{malWord}",NICK_ALL_NUMBER:f.ERROR_GENERAL_NICK_ALL_NUM||"不能全为数字",NICK_INVALID:"用户名不符合要求"},h=function(b){return this instanceof h?(b=b||{},this.el=b.el&&a.one(b.el),void this._init()):new h(b)};return a.augment(h,b.Target,{_init:function(){!this.el},regexp:{illegal:/#|[~～]|[!！]|[?？]|\.\.|--|__|－|＿|※|▲|△| | |@/g,allNumber:/^\d+$/},validate:function(b){var c,d,e=Q.defer(),f=this.el.val(),h=this.size(f);if(this.hideSuggest(),5>h||h>25?c="NICK_LENGTH_INVALID":this.legal(f)?this.allNumber(f)&&(c="NICK_ALL_NUMBER"):(c="NICK_ILLEGAL",d=a.substitute(g[c],{malWord:(f.match(this.regexp.illegal)||[]).join(",")})),c)e.reject(new XError(c,d||g[c]));else{if(!b)return this.checkExist();e.resolve()}return e.promise},size:function(a){var b=a.replace(/[^\x00-\xff]/g,"**");return b.length},legal:function(a){return!this.regexp.illegal.test(a)},allNumber:function(a){return this.regexp.allNumber.test(a)},checkExist:function(){var b=Q.defer(),d=this.el.val();if(this.checkingExist)return b.promise;if(this.preCheckNick===this.el.val())return b.resolve(),b.promise;if(!e.checkNickUrl)return b.reject(new XError("NickError",f.GENERIC_FAILURE||"系统错误，请刷新重试！")),b.promise;var h=this,i={};return i[this.el.attr("name")]=d,this.preCheckedNick="",this.checkingExist=!0,c({url:e.checkNickUrl,type:"post",data:i,dataType:"json",complete:function(c){return h.checkingExist=!1,c&&c.success?(h.preCheckedNick=d,void b.resolve()):c||c.reason?c.commandNick?(h.showSuggest(c.commandNick),void b.reject(new XError("NickInvalid",f[c.reason]||f[c.message]||"该会员名已被占用"))):(b.reject(new XError("NickInvalid",a.substitute(f[c.reason]||f[c.message],c)||g.NICK_INVALID)),void h.hideSuggest()):void b.reject(new XError("NickError",f.GENERIC_FAILURE||"系统错误，请刷新重试！"))}}),b.promise},showSuggest:function(b){this.hideSuggest(),a.all("#J_NickSuggest").show();var c=this;this.suggestList=new d({render:"#J_NickSuggest",width:220});for(var e=0,g=b.length;g>e;e++)this.suggestList.addChild(new d.Item({content:b[e]}));a.all("#J_NickSuggest").prepend('<div class="nick-suggest-hd">'+f.r_ui_recommendNickTip+"：</div>"),this.suggestList.render(),this.suggestList.on("click",function(a){var b=a.target.get("content");c.el.val(b),c.hideSuggest(),c.fire("select",{nick:b})})},hideSuggest:function(){this.suggestList&&(a.all("#J_NickSuggest").html("").hide(),this.suggestList=null)}}),h},{requires:["event","io","register/components/xerror","menu"]});KISSY.add("register/components/similar",function(a){var b={_str1:null,_str2:null,_matrix:null,init:function(b,c){return a.isString(b)&&a.isString(c)?(this._str1=b,this._str2=c,b.length&&c.length&&this._createMatrix(b.length+1,c.length+1),this._matrix&&this._initMatrix(),this):void 0},get:function(){return 1-this._getDistance()/Math.max(this._str1.length,this._str2.length)},_getDistance:function(){var a=this._str1.length,b=this._str2.length;if(!a||!b)return Math.max(a,b);for(var c=this._str1.split(""),d=this._str2.split(""),e=0,f=0,g=0;e++<a;)for(f=0;f++<b;)g=c[e-1]===d[f-1]?0:1,this._matrix[e][f]=Math.min(this._matrix[e-1][f]+1,this._matrix[e][f-1]+1,this._matrix[e-1][f-1]+g);return this._matrix[e-1][f-1]},_initMatrix:function(){for(var a=this._matrix[0].length,b=this._matrix.length,c=Math.max(a,b);c--;)a-1>=c&&(this._matrix[0][c]=c),b-1>=c&&(this._matrix[c][0]=c)},_createMatrix:function(b,c){if(!(!a.isNumber(b)||!a.isNumber(c)||1>b||1>c)){this._matrix=new Array(b);for(var d=0;b>d;)this._matrix[d++]=new Array(c)}}},c=function(a,c){return b.init(a,c).get()};return c});KISSY.add("register/utils/messages",function(a){var b=function(a){return this instanceof b?(a=a||{},this.messages=a.messages,void this._init()):new b(a)};return a.augment(b,{_init:function(){},hideAll:function(){a.each(this.messages,function(a){a.hide()})},hideAllIfNotOk:function(){a.each(this.messages,function(a){a.hideIfNotOk()})}}),b});