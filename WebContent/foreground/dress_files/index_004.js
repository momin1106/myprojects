KISSY.add("nav/tpl",function(t){return function(t){t||(t={});{var e,n="";Array.prototype.join}n+="  ";for(var a=0;a<t.result.length;a+=1){n+="\n<dl>\n  <dt>\n    ",n+=t.result[a].cat_href?'\n    <a href="'+(null==(e=t.result[a].cat_href)?"":e)+'">'+(null==(e=t.result[a].cat_name)?"":e)+"</a>\n    ":"\n    "+(null==(e=t.result[a].cat_name)?"":e)+"\n    ",n+="\n  </dt>\n  <dd>\n    ";for(var o=0;o<t.result[a].lists.length;o+=1)n+='\n    <a href="'+(null==(e=t.result[a].lists[o].cat_href)?"":e)+'" class=" ',"true"===t.result[a].lists[o].is_hot&&(n+="ext-hot"),n+='">'+(null==(e=t.result[a].lists[o].cat_name)?"":e)+"</a>\n    ";n+="\n  </dd>\n</dl>\n  "}return n}}),KISSY.add("market/scrollFollow",function(t,e,n,a){function o(e){e=e||{},t.isString(e)?this.followEl=e:t.each(r,function(t,n){this[n]=e[n]||t},this),this.init()}var s=e,i=n,l=6===a.ie?50:10,r={followEl:"",fixTop:!1};return o.prototype={constructor:o,init:function(){this.followEl=t.one(this.followEl),this.followEl&&(this.top||(this.top=this.followEl.offset().top),this.cssPosition=this.followEl.css("position"),this.cssWidth=this.followEl.css("width"),this.hander={},this._bind())},_bind:function(){i.on(window,"scroll",function(){var e=this.hander;e.cancel&&e.cancel(),this.hander=t.later(this.resetPosition,l,!1,this)},this)},resetPosition:function(){var t=parseInt(s.scrollTop(window),10),e=this.followEl,n=+this.top;t>n?(e.addClass("box-fixed"),this.fixIt(t)):n>t&&(e.removeClass("box-fixed"),"auto"!==this.status&&(e.css({position:this.cssPosition,top:"",width:""}),this.status="auto"),this.fixTop&&(this.top=e.offset().top))},fixIt:function(t){{var e=this.followEl;this.top}6===a.ie?e.css({position:"absolute",top:t,width:this.cssWidth}):"follow"!==this.status&&e.css({position:"fixed",top:0,width:this.cssWidth}),this.status="follow"}},o},{requires:["dom","event","ua"]}),KISSY.add("sm-nav-2014",function(S,ScrollFollow,tplRend,io,Node,DOM,Event,UA,Base,Cookie){function Head(t,e){this.init.apply(this,arguments)}function Nav(){this.init.apply(this,arguments)}function X(){this.init.apply(this,arguments),this.feedback.apply(this,arguments)}var E=Event,D=DOM,isRetina=function(t){var e="(-webkit-min-device-pixel-ratio: 1.5),                          (min--moz-device-pixel-ratio: 1.5),                          (-o-min-device-pixel-ratio: 3/2),                          (min-resolution: 1.5dppx)";return t.devicePixelRatio>1?!0:t.matchMedia&&t.matchMedia(e).matches?!0:!1}(window),headCfg={navClass:".head",formClass:".market-search",moreMarketClass:".more-button",searchKeyClass:".search-keyword"};Head.fn=Head.prototype,Head.fn.init=function(t,e){this.config=S.merge(e,headCfg),this.suggestSwitch=!0,this.module=t,this.navEl=S.one(t).one(this.config.navClass),this.setRetina(),this.moreMarket(),this.suggest(),this.optSelect(),this.searchForm()},Head.fn.setRetina=function(){var t=this,e=S.one(".logo img",t.module);e&&e.attr("data-retina")&&isRetina&&e.attr("src",e.attr("data-retina"))},Head.fn.moreMarket=function(){function t(){var t="//tce.alicdn.com/api/data.htm?ids="+s,n={market:'<dt><a href="{href}" target="_blank">{text}</a></dt>',sub_market:'<dd><a href="{href}" target="_blank">{text}</a></dd>'};e=!0,io({url:t,success:function(t){var e=t[s].value.markets;S.each(e,function(t){var e=D.create("<dl></dl>");D.append(e,o);var a=D.create(S.substitute(n.market,{href:t.href,text:t.text}));D.append(a,e);var s=t.subMarkets;S.each(s,function(t){var a=D.create(S.substitute(n.sub_market,{href:t.href,text:t.text}));D.append(a,e)}),D.css(o,{background:"#fff",height:"auto"})})},error:function(){e=!1,S.log("get more markets error!")},dataType:"jsonp",jsonp:"callback",jsonpCallback:"moreMarketsCallback"})}var e=!1,n=this,a=D.get(".more-label",n.navEl.one(n.config.moreMarketClass)),o=D.get(".more-content",n.navEl.one(n.config.moreMarketClass)),s="321756";return E.on([a,o],"mouseenter mouseleave",function(n){"mouseenter"===n.type?(D.addClass(a,"m-hover"),D.show(o),e===!1&&t()):(D.removeClass(a,"m-hover"),D.hide(o))}),this},Head.fn.suggestBak=function(){var t=this,e=t.navEl.one(".input"),n=t.navEl.one(".input-wrap");return e.on("focusin",function(t){S.one(this).addClass("focus"),n.addClass("active")}).on("focusout",function(t){S.one(this).removeClass("focus"),n.removeClass("active")}),function(){var e=D.get(t.config.searchKeyClass,t.navEl),n="//suggest.taobao.com/sug?area=list&code=utf-8",a="new",o=this,s=!1,i=Cookie.get("t")||"";parseInt(i.slice(-1),16)%2&&(s=!0),s||(n="//suggest.taobao.com/sug?area=auction&code=utf-8",a="old"),S.use(+KISSY.version>1.3?"gallery/suggest/1.0/":"suggest",function(s){function i(t,e,n,o){i.inputQueryInput||(i.abver=S.one('<input name="abver" type="hidden" />').appendTo(t),i.inputQueryInput=S.one('<input name="input_query" type="hidden" />').appendTo(t),i.suggestOffsetInput=S.one('<input name="suggest_offset" type="hidden" />').appendTo(t),i.fromInput=S.one('<input name="from" type="hidden" />').appendTo(t)),i.inputQueryInput.val(e),i.suggestOffsetInput.val(n),i.fromInput.val(o),i.abver.val(a)}e&&(o.suggest=new S.Suggest(e,n,{resultFormat:"",submitOnSelect:!0,containerCls:"input-drop",closeBtn:!1}),o.suggest.on("beforeShow",function(t){var e=o.suggest.query;S.one(t.currentTarget.content).all("li").each(function(){var t=this.attr("key"),n=new RegExp("(^.*)"+e+"(.*$)","gi"),a=t.replace(n,'<span>$1</span><span class="normal">'+e+"</span><span>$2</span>");this.html(a)})}),o.suggest.on("beforeSubmit",function(e){D.get(".local",t.navEl).click()}),o.suggest.on("beforeStart",function(e){return t.suggestSwitch}),o.suggest.on("itemSelect",function(t){var e=o.suggest,n=0,a=e.selectedItem,s=D.query("li",e.content);S.each(s,function(t,e){return t==a?(n=e,!1):void 0});var l=e.query,r="suggest";i(e.textInput.form,l,n,r)}))})}(),this},Head.fn.suggest=function(){var t=this;"undefined"==typeof window.define?window.define=function(t,e,n){KISSY.add(t,e,function(t,e,a,o){n.apply(null,[].slice.call(arguments,1))})}:parseFloat(KISSY.version)>=6&&KISSY.config({modules:{combobox:{alias:["kg/combobox/0.0.2/"]}}});var e=["tbc/search-suggest/1.5.0/index","tbc/search-suggest/1.5.0/new_suggest.css"];return KISSY.use(e,function(e,n){function a(t,n,s,i){a.inputQueryInput||(a.abver=e.one('<input name="abver" type="hidden" />').appendTo(t),a.inputQueryInput=e.one('<input name="input_query" type="hidden" />').appendTo(t),a.suggestOffsetInput=e.one('<input name="suggest_offset" type="hidden" />').appendTo(t),a.fromInput=e.one('<input name="from" type="hidden" />').appendTo(t)),a.inputQueryInput.val(n),a.suggestOffsetInput.val(s),a.fromInput.val(i),a.abver.val(o)}self.suggest=new n({sugConfig:{sourceUrl:"//suggest.taobao.com/sug",node:".search-keyword"},mods:{sort:["list"]}});e.all(headCfg.navClass).all(".search-combobox-input");self.suggest.on("beforeShow",function(t){var n=self.suggest.query;e.one(t.currentTarget.content).all("li").each(function(){var t=this.attr("key"),e=new RegExp("(^.*)"+n+"(.*$)","gi"),a=t.replace(e,'<span>$1</span><span class="normal">'+n+"</span><span>$2</span>");this.html(a)})}),self.suggest.on("beforeSubmit",function(e){D.get(".local",t.navEl).click()}),self.suggest.on("beforeStart",function(e){return t.suggestSwitch}),self.suggest.on("itemSelect",function(t){var n=self.suggest,o=0,s=n.selectedItem,i=D.query("li",n.content);e.each(i,function(t,e){return t==s?(o=e,!1):void 0});var l=n.query,r="suggest";a(n.textInput.form,l,o,r)});var o="new",s=!1,i=Cookie.get("t")||"";parseInt(i.slice(-1),16)%2&&(s=!0),s||(o="old")}),this},Head.fn.optSelect=function(){var t=this,e=t.navEl.one(".opt-drop"),n=t.navEl.one(".input-wrap"),a=t.navEl.one(".opt"),o=a.one(".icon"),s=function(){t.suggestSwitch=t.suggestSwitch?!1:!0};return e?(a.on("mouseenter",function(){n.addClass("hl"),e.show(),o.addClass("reverse")}).on("mouseleave",function(){n.removeClass("hl"),e.hide(),o.removeClass("reverse")}),E.delegate(e,"click","a",function(t){s(),t.preventDefault(),e.hide();var i=a.one("span"),l=i.clone(!0);i.remove();S.one(t.currentTarget).one("span").prependTo(a);l.appendTo(t.currentTarget),n.removeClass("hl"),o.removeClass("reverse")}),this):this},Head.fn.searchForm=function(){var t=this,e=D.get(t.config.formClass,t.navEl),n=D.get("a.global",t.navEl),a=D.get("a.local",t.navEl),o=D.get(t.config.searchKeyClass,t.navEl),s=function(t){var e,n,a="",o="",s=window.parent||window,i=s.document.getElementsByTagName("meta");for(e=0;e<i.length;e++)if(n=i[e],"spm-id"==n.getAttribute("name")||"data-spm"==n.getAttribute("name")){a=D.attr(n,"content");break}return o=S.one("body").attr("data-spm"),a+=o?"."+o:"",a+".1000187."+t},i=function(n){var a=t.navEl.one(".opt").one("span"),i=a.attr("data-type")||null,l=a.attr("data-action")||null,r=a.attr("data-target")||null,u=a.attr("data-cat")||null,c=a.attr("data-allaction")||null,d=a.attr("data-shop")||null;if(o.value=o.value?o.value.replace(/<[^<>]*?>/g,""):"",!n||u&&S.one('<input type="hidden" name="cat">').attr("value",u).appendTo(e),d&&S.one('<input type="hidden" name="app">').attr("value","shopsearch").appendTo(e),o.value.length?e.action=n?l:c||l:(e.action=n?r:"//s.taobao.com/",o.name=""),e.action.indexOf("?")>=0)for(var p,h,f,v=e.action,m=v.slice(v.indexOf("?")+1).split("&"),g=m.length;g--;)m[g].indexOf("=")&&(f=m[g].split("="),p=f[0],h=f[1],S.one('<input type="hidden" name="'+p+'">').attr("value",h).appendTo(e));var x=0==n?2:1,w="shop"==i?2:0,b=s(x+w),y=t.navEl.one(".J_spmId")||S.one('<input type="hidden" name="spm" class="J_spmId">');y.attr("value",b).appendTo(e)};return E.on([n,a],"click",function(t){var a=t.currentTarget===n?0:1;t.preventDefault(),i(a),e.submit()}),this};var navCfg={el:".nav",hlItem:"#initial-hl-nav-item,#J_NavId",hlTag:"data-tag"};return Nav.prototype.init=function(t,e){this.config=S.merge(e,navCfg),S.all(this.config.el).length>0&&(this.navEl=S.one(this.config.el,t),this.index(),this.crossBrowserFix(),this.extCat(),this.autoHighlight())},Nav.prototype.index=function(){var t=this,e=!1,n=null;t.navEl.one(".list-index").on("mouseenter mouseleave",function(a){"mouseenter"==a.type?(clearTimeout(n),t.navEl.one(".list-index").hasClass("current")?e=!0:(t.navEl.one(".list-index").addClass("current"),t.navEl.one(".list-index").addClass("hl"),t.navEl.one(".sm-cat-list").addClass("hover"))):(e||t.navEl.one(".list-index").removeClass("current"),n=setTimeout(function(){t.navEl.one(".sm-cat-list").removeClass("hover"),t.navEl.one(".list-index").removeClass("hl")},50))}),t.navEl.one(".sm-cat-list").on("mouseenter mouseleave",function(e){"mouseenter"===e.type?clearTimeout(n):n=setTimeout(function(){t.navEl.one(".list-index").removeClass("hl"),t.navEl.one(".sm-cat-list").removeClass("hover")},50)})},Nav.prototype.highlight=function(t){var e=this,n=e.navEl.all(".hl-list").all("a"),a=e.navEl.one(".sm-cat-list-main").all(".cat-title"),o=!1;return n.removeClass("current"),a.removeClass("current"),n.each(function(){return this.attr(e.config.hlTag)==t?(S.one(this).addClass("current"),o=!0,!1):void 0}),e.navEl.one(".list-index").hasClass("current")&&e.navEl.one(".sm-cat-list").addClass("current"),!o&&a.each(function(){return this.attr(e.config.hlTag)==t?(S.one(this).addClass("current"),e.navEl.one(".list-index").addClass("current"),e.navEl.one(".sm-cat-list").addClass("current"),!1):void 0}),this},Nav.prototype.highlightQuery=function(){var t=window.SRP&&window.SRP.Global&&window.SRP.Global.raw_q||S.all(".search-keyword").val()||S.all(".search-combobox-input").val()||"",e=window.SRP&&window.SRP.Global&&window.SRP.Global.s||1,n=this,a=location.href;if(t&&1==e){var o=n.navEl.all(".hl-list").all("a"),s=n.navEl.one(".sm-cat-list-main").all(".cat-title");o.removeClass("current"),s.removeClass("current"),s.each(function(){var e=this.one("a"),a=e?e.attr("href"):"";if(e&&e.text()==t&&a.indexOf("s.taobao.com")>0){return S.one(this).addClass("current"),n.navEl.one(".list-index").addClass("current"),n.navEl.one(".sm-cat-list").addClass("current"),!1}})}else n.highlightUrl(a)},Nav.prototype.highlightUrl=function(t){var e=function(t){return t.replace(/&?\bspm=[^&#]*/g,"").replace(/&?\bad_id=[^&#]*/g,"").replace(/&?\bam_id=[^&#]*/g,"").replace(/&?\bcm_id=[^&#]*/g,"").replace(/&?\bpm_id=[^&#]*/g,"").replace(/&{2,}/g,"&").replace(/\?&/,"?").replace(/\?($|#)/,"$1").replace(/[\/?]*$/,"").replace(/https:\/\/[^\/]*(\/go)?/,"").replace(/http:\/\/[^\/]*(\/go)?/,"").replace(/\/\/[^\/]*(\/go)?/,"").split("&")[0]},n=this,a=n.navEl.all(".hl-list").all("a"),o=n.navEl.one(".sm-cat-list-main").all(".cat-title"),s=!1;try{var t=t.split("?")[0]}catch(i){}return t=e(t),a.removeClass("current"),o.removeClass("current"),a.each(function(){return e(S.one(this).attr("href")).length>0&&e(S.one(this).attr("href"))==t?(S.one(this).addClass("current"),s=!0,!1):void 0}),n.navEl.one(".list-index").hasClass("current")&&n.navEl.one(".sm-cat-list").addClass("current"),!s&&o.each(function(){var a=S.one(this).one("a");return a&&e(a.attr("href"))==t?(s=!0,S.one(this).addClass("current"),n.navEl.one(".list-index").addClass("current"),n.navEl.one(".sm-cat-list").addClass("current"),!1):void 0}),this},Nav.prototype.autoHighlight=function(){var t=this,e=location.href,n=null,a=!1,o=10,s=50;!function i(){--o>0&&(n=n||D.get(t.config.hlItem),n?S.trim(n.value)&&(t.highlight(n.value),a=!0):setTimeout(function(){i()},s))}(),S.ready(function(){o=o?2:0}),a||(e.indexOf("taobao.com/list")>0?t.highlightQuery():t.highlightUrl(e))},Nav.prototype.crossBrowserFix=function(){var t=this;return UA.ie&&t.navEl.all(".main-list").each(function(){var t=0;S.one(this).all("li").each(function(){t+=+S.one(this).outerWidth()}),S.one(this).width(t+10)}),this},Nav.prototype.extCat=function(){var t,e,n=this;n.extPopup=n.navEl.one(".market-nav-ext"),"open"==n.extPopup.attr("data-open")&&(n.extTemplate=tplRend,n.extData=[],n.oldData=[],n.initExtData(),n.navEl.one(".sm-cat-list-main").delegate("mouseenter mouseleave","dl",function(a){"mouseenter"==a.type?(e&&(clearTimeout(t),e.removeClass("hover")),e=S.one(a.currentTarget),e.addClass("hover"),n.openExtPopup(e)):t=setTimeout(function(){e.removeClass("hover"),n.extPopup.hide()},300)}),n.extPopup.on("mouseenter mouseleave",function(a){"mouseenter"==a.type?clearTimeout(t):(e&&e.removeClass("hover"),n.extPopup.hide())}),"list.taobao.com"!=location.host&&"spu.taobao.com"!=location.host&&"/market/baobao/2014/index.php"!=location.pathname&&"/go/market/baobao/2014/index.php"!=location.pathname&&"s.taobao.com"!=location.host&&new ScrollFollow({followEl:n.navEl.one(".fix-box")}))},Nav.prototype.initExtData=function(){var theNav=this,dls=theNav.navEl.one(".sm-cat-list-main").all("dl"),transData=function(t){var e,n,a=[];for(e=0;e<t.length;e+=1)0==e||"true"==t[e].is_title?(n&&a.push(n),n=t[e],n.lists=[]):n&&n.lists.push(t[e]);return n&&a.push(n),a};dls.each(function(dl){var str,strOld,data,dataOld;dl=S.one(dl),str=dl.one(".J_ext_data").val(),strOld=dl.one(".J_old_data").val(),window.JSON?(data=JSON.parse(str),dataOld=JSON.parse(strOld)):(data=eval(str),dataOld=eval(strOld)),theNav.extData[theNav.nodeIndex(dl)]=transData(data),theNav.oldData[theNav.nodeIndex(dl)]=transData(dataOld)})},Nav.prototype.nodeIndex=function(t){var e,n,a=t,o=0,s=a[0];if(n=s&&s.parentNode,!n)return-1;for(e=s;e=e.previousSibling;)1===e.nodeType&&o++;return o},Nav.prototype.renderExt=function(t){var e=this,n=e.nodeIndex(t),a=e.extTemplate({result:e.extData[n]}),o=e.extTemplate({result:e.oldData[n]});e.extPopup.attr("data-spm-ab",n),e.extPopup.removeAttr("data-spm-ab-max-idx"),e.extPopup.one(".ext-wrap").html(a),e.extPopup.one(".old-cat").html(o)},Nav.prototype.openExtPopup=function(t){var e=this,n=e.nodeIndex(t),a=t.outerWidth();n>=5?(n-=1,e.extPopup.one(".bd-fix").css({left:a})):e.extPopup.one(".bd-fix").css({left:0}),e.renderExt(t),e.extPopup.show(),e.extPopup.css({"background-image":"url("+t.attr("data-ext-img")+")",left:n*a})},X.prototype.init=function(t,e){new Head(e),window.NAV=new Nav(e)},X.prototype.feedback=function(t,e){var n=S.one(".J_feedback_tpl",e);if(n){var a=S.one(n.html()).appendTo(S.one("body")),o=!0,s=S.require("dom"),i=S.all("a",a).length,l=function(t){a.addClass("foobar").removeClass("foobar"),t!==o&&(t?(i>1?S.one("#J_GoTop",a).show():a.show(),o=!0):(i>1?S.one("#J_GoTop",a).hide():a.hide(),o=!1,a.fire("mouseenter")))},r=function(){var t=500;l(s.scrollTop()>t?!0:!1)},u=function(){s.viewportWidth()>1270?a.style("right",s.viewportWidth()/2-650+"px"):a.style("right","10px")};u(),S.one(window).on("scroll",function(t){r()}).on("resize",function(){u()}),S.one("#J_GoTop").on("click",function(t){S.one(window).animate({scrollTop:{value:0}},{duration:.2})}),r()}},X},{requires:["market/scrollFollow","nav/tpl","io","node","dom","event","ua","base","cookie"]});