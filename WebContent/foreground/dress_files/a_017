define("tbc/search-suggest/1.5.0/index",["combobox","base","json","cookie","event","node","dom"],function(e,t,a){var r,n,i,s,o,u,c,l,f=e("combobox"),d=e("base"),g=e("json"),p=(e("cookie"),e("event")),h=e("node"),m=e("dom");r=function(e){function t(e){t.superclass.constructor.call(this,e||{})}var a=f;return t=a.extend({initializer:function(){var e=this;e.on("afterRenderData",function(){e.fire("beforeShow")})},sendRequest:function(e){var t=this,a=t.constructor.superclass.sendRequest;if(t.fire("beforeQueryChange",{query:e})===!1)return!1;t.queryTimer&&clearTimeout(t.queryTimer),t.laterTimer&&clearTimeout(t.laterTimer);var r=arguments;t.queryTimer=setTimeout(function(){t.queryTimer=null,t.laterTimer=setTimeout(function(){t.later=!1},500),a.apply(t,r)},t.later?200:50),t.later=!0},handleKeyDownInternal:function(e){var t=this,a=t.constructor.superclass.handleKeyDownInternal;return t.fire("beforeKeyDown",{event:e})===!1?!1:void a.apply(this,arguments)},handleKeyEventInternal:function(e){var t=this,a=t.constructor.superclass.handleKeyEventInternal;return t.fire("beforeKeyDown",{event:e})===!1?!1:void a.apply(this,arguments)},setValueInternal:function(e){var t=this,a=t.constructor.superclass.setValueInternal;return t.fire("beforeSetInputValue",{event:e})===!1?!1:void a.apply(this,arguments)},setValueFromAutocomplete:function(e){var t=this,a=t.constructor.superclass.setValueFromAutocomplete;return t.fire("beforeSetInputValue",{event:e})===!1?!1:void a.apply(this,arguments)},renderItems:function(e,t,a){var r,n,i=this,s=i.get("sugConfig").resultFormat,o=i.resultArr||(i.resultArr=[]),u="",c=e;KISSY.each(t,function(e,i){if(!e||!e[0])return void t.splice(i,1);for(r=e[0];r.indexOf(c)<0;)c=c.substr(0,c.length-1);""===c?(u=r,r=""):0===r.indexOf(c)&&(u=c,r=r.replace(c,""));for(var l in o)if(n=o[l],n.textContent===e[0]&&n.unique)return;a=a.replace("{format}",s),o.push({textContent:e[0],content:KISSY.substitute(a,{query:u,text:r,index:i+1,count:e[1]}),list:!0})}),i.resultArr=o},alignInternal:function(e){var t=this,a=t.constructor.superclass.alignInternal;return t.fire("beforeShow",{event:e})===!1?!1:void a.apply(this,arguments)}},{ATTRS:{dataSourceCfg:{value:{xhrCfg:{url:"",dataType:"jsonp",scriptCharset:"utf-8",data:{code:"utf-8"}},allowEmpty:!0,paramName:"q",cache:!0}},mods:{value:{},setter:function(e){return e}}}}),t.RemoteDataSource=a.RemoteDataSource,t.LocalDataSource=a.LocalDataSource,e=t}(),n=function(e){return e={"new":{tmpl:'<div class="item-wrapper {prefixCls}menu-extras-xp" data-key="q={$queryUrl}&suggest=new_{$index}&tab=shopping&auction_tag[]=1154"><span class="{prefixCls}menu-xp-tag">新品</span><span class="{prefixCls}menu-xp-icon">新品</span><span class="{prefixCls}menu-xp">“{$query}”相关{new}新品</span></div>'},shop:{tmpl:'<div class="item-wrapper {prefixCls}menu-extras-dp" data-action="//shopsearch.taobao.com/search" data-key="q={$queryUrl}&suggest=shop_{$index}"><span class="{prefixCls}menu-dp">{$query} <b>相关店铺</b></span><span class="{prefixCls}menu-dp-icon">店铺</span></div>'},cat:{tmpl:'<div class="{prefixCls}menu-extras-cate" data-key="q={$2}&cat={$1}&suggest=cat_{$index}"><span class="{prefixCls}menu-key">{$2}</span><span class="{prefixCls}menu-cate">在<b>{$0}</b>分类下搜索</span></div>'},list:{tmpl:"<div data-index='{index}' class='item-wrapper' data-key='q={textContent}&suggest=0_{index}'><span class='item-text'>{query}<b>{text}</b></span><span class='item-count'>{format}</span></div>"},global:{tmpl:'<div class="{prefixCls}menu-extras-cate" data-key="q={$queryUrl}&promote=2097152&suggest=global_{$index}"><span class="{prefixCls}menu-key">{$query}</span><span class="{prefixCls}menu-cate">在全球购市场中搜索</span></div>'},history:{tmpl:'<div class="{prefixCls}menu-extras-history" {attr} data-key="q={historyItemQuery}&suggest={extraParam}_{index}" data-index="_his_{index}" data-value="{historyItemValue}"><span class="{prefixCls}menu-history-key">{historyItemValue}</span><span data-type="{extraParam}" class="{prefixCls}menu-history-delete">删除</span></div>'},scene:{tmpl:'<div class="{prefixCls}menu-extras-cate extras-scene" data-action="//fa.taobao.com/search" data-key="q={scene}&suggest=scene_{$index}"><span class="{prefixCls}menu-key">{scene}</span><b>装修宝典/选购秘籍</b></div>'},dapei_bottom:{tmpl:'<div class="item-wrapper {prefixCls}menu-extras-dp" data-source-stat="source_click=suggest_kfc&source_pv=suggest_kfc#!Content" data-action="//pose.taobao.com/search" data-key="q={dapei_bottom}"><span class="{prefixCls}menu-dp">{dapei_bottom}<b>全套搭配</b></span></div>'},dapei_top:{tmpl:'<div class="{prefixCls}menu-extras-cate" data-source-stat="source_click=suggest_jqc&source_pv=suggest_jqc#!Content" data-action="//pose.taobao.com/search" data-key="q={dapei_top}"><span class="{prefixCls}menu-key">{dapei_top}</span><span class="{prefixCls}menu-cate">在<b>搭配</b>下搜索</span></div>'},tmall:{tmpl:'<div class="{prefixCls}menu-extras-cate extras-mall" data-key="q={tmall}&suggest=tmall_{$index}&tab=mall"><span class="{prefixCls}menu-key">{tmall}</span><b>天猫相关</b></div>'},c2c_activity:{tmpl:'<div class="{prefixCls}menu-extras-cate extras-active" data-key="q={c2c_activity_query} {c2c_activity_tag}&suggest=active_{$index}&tab=deal"><span class="{prefixCls}menu-key">{c2c_activity_query}</span><span class="{prefixCls}menu-cate">在 <b>{c2c_activity_tag}</b> 中搜索</span></div>'},showExtra:!1}}(),i=function(e){function t(e){return a?a:(t.superclass.constructor.call(this,e||{}),void(a=this))}var a,r=d;return KISSY.extend(t,r,{pluginInitializer:function(e){var t=this;t.set("caller",e)},getCookie:function(e){var t=window;if(t.userCookie&&!KISSY.isUndefined(t.userCookie[e]))return t.userCookie[e];if(t.SRP_COOKIES||(t.SRP_COOKIES={})&&KISSY.isUndefined(SRP_COOKIES[e])){var a=document.cookie.match("(?:^|;)\\s*"+e+"=([^;]*)");SRP_COOKIES[e]=a&&a[1]?decodeURIComponent(a[1]):""}return SRP_COOKIES[e]},fireEvent:function(e,t){var a=document;if(a.createEvent){var r=a.createEvent("MouseEvents");r.initEvent(t,!0,!1),e.dispatchEvent(r)}else a.createEventObject&&e.fireEvent("on"+t)}},{ATTRS:{pluginId:{value:"utils"}}}),e=t}(),s=function(e){function t(e){return a||(t.superclass.constructor.call(this,e||{}),a=this,a.initialize()),a}var a,r=d,n=g;return t.ATTRS={src:{value:location.protocol+"//g.alicdn.com/tbc/search-suggest/1.3.7/storage.swf"},bridge:{value:null},hasInit:{value:!1}},KISSY.extend(t,r,{initialize:function(e){e=e||{};var t=this;try{t._addFlash(e.appendTo),t.hasInit=!0}catch(a){KISSY.log(a.message)}},_saveToArr:function(e,t){var a=this.lazyArr||[];a.push({func:e,args:t}),this.lazyArr=a},_addFlash:function(e){var t,a=this,r=document,n=r.createElement("div"),i=a.get("src"),s="";window.__StorageIsReady=function(e){a.isLoaded=!0;var t=a.lazyArr;KISSY.each(t,function(e){e.func.apply(a,e.args)})},n.id="storagetool",n.style.height=0,n.style.overflow="hidden",s+='<object id="J_StorageObj" name="J_StorageObj" ',s+='classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="1" height="1" ',s+='codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab">',s+='<param name="movie" value="'+i+'" />',s+='<param name="allowScriptAccess" value="always" />',s+='<embed name="J_StorageEmbed" src="'+i+'" width="1" height="1" ',s+='allowScriptAccess="always" type="application/x-shockwave-flash" ',s+='pluginspage="http://www.adobe.com/go/getflashplayer">',s+="</embed></object>",e=e||r.body,e.appendChild(n),n.innerHTML=s,-1!==navigator.appVersion.indexOf("MSIE")?(n.style.zoom=1,n.style.filter="alpha(opacity=10)",t=window.J_StorageObj):(n.style.opacity=.1,t=r.J_StorageEmbed),a.set("bridge",t)},save:function(e,t,a,r){var i=this,s=i.get("bridge");if(!i.isLoaded)return void i._saveToArr(arguments.callee,arguments);try{return s.save(e,t),s.read(e)?n.parse(s.read(e)).length:(a&&a.onSuccess(val),0)}catch(o){a&&a.onFailure&&a.onFailure(o)}},read:function(e,t,a){var r,n=this,i=n.get("bridge");if(a=a||0,!n.isLoaded)return void n._saveToArr(arguments.callee,arguments);try{if(i.read)r=i.read(e),t&&t.onSuccess(r);else{if(200===a)return void(t&&t.onFailure&&t.onFailure(s));setTimeout(function(){n.read(e,t,a+1)},500)}return r}catch(s){t&&t.onFailure&&t.onFailure(s)}}}),e=t}(),o=function(e){function t(e){t.superclass.constructor.call(this,e||{})}var a=d,r=i;return KISSY.extend(t,a,{getBucket:function(){var e=this,t=e.getCookieT(),a=e.getTestBucket()||e.retBucket(t,20,-4,4)-0;return a},getTestBucket:function(){var e=location.search,t=e.match(/alg_bts=(\d+)/);return t&&t[1]?t[1]-0:void 0},getCookieT:function(){var e=new r,t=e.getCookie("t");return t},retBucket:function(e,t,a,r){return!e&&"0"||this.countBucket(e,t,a,r)},countBucket:function(e,t,a,r){var n=e.substr(a,r),i=parseInt(n,16),s=i%t+1;return s+""}},{ATTRS:{pluginId:{value:"bts"}}}),e=t}(),u=function(e){function t(e){t.superclass.constructor.call(this,e||{}),this.initialize()}var a=d,r=g,n=s,i="localQuery";return KISSY.extend(t,a,{initialize:function(){var e=this,t=e.get("name"),a=e.get("tab"),r=e.get("user");"item"===a&&(a="baobei"),e.storageKey=i+t+a+r,e._getStorage()},checkFlash:function(e){this.storage.read(e)},_setKey:function(e){var t=this,a=e.name||t.get("name"),r=e.tab||t.get("tab"),n=e.user||t.get("user");"item"===r&&(r="baobei"),t.storageKey=i+a+r+n,t.set("tab",r),t.set("name",a),t.set("user",n),this.datalist=null},_save:function(e,t){if(!e.match(/<>'"/)&&!t.match(/<>'"/)){var a=this._getDatalist(),r=encodeURIComponent(e),n={key:r,value:encodeURIComponent(t),time:KISSY.now()};this._deleteItemByValue(a,r),a.unshift(n)}},_deleteItemByValue:function(e,t){for(var a,r=null,n=0;n<e.length;n++)a=e[n].key,a==t&&(r=e.splice(n,1),n--)},_query:function(e){var t,a,r=this._getDatalist(),n=[];return e?(e=encodeURIComponent(e),KISSY.each(r,function(r,i){t=r.key,a=r.value,(0===t.indexOf(e)||0===a.indexOf(e))&&n.push(r)}),this._distinctByValue(n)):this._distinctByValue(r)},_distinctByValue:function(e){for(var t,a=[],r=0,n=e.length;n>r;r++)t=e[r],t.value.match(/%3C|%3E|[<>'"]/g)||!this._hasItemOfValue(a,t.value)&&a.push(t);return a},_hasItemOfValue:function(e,t){for(var a=!1,r=e.length-1;r>=0;r--)e[r].value===t&&(a=!0);return a},_cleanBefore:function(e){for(var t,a=this._getDatalist(),r=0,n=a.length-1;n>=0;n--)if(t=a[n],t.time>e){r=n+1;break}a.length=r},_getDatalist:function(){return this.datalist||(this.datalist=this.storage.read()||[]),this.datalist},_getStorage:function(){var e=this.get("storageType");switch(e){case"flashStorage":this.storage=this._initFlashStorage();break;default:this.storage=!1}},_initFlashStorage:function(){var e=this;return{save:function(){return(new n).save(e.storageKey,r.stringify(e.datalist))},read:function(t){var a=(new n).read(e.storageKey,t);if(a){var i=r.parse(a);return i}return void 0}}},destructor:function(){this.datalist=null,i=null},save:function(e,t){if(""!=t){var a,r=this.storage.read();r&&(a=r.length);var n=this._save(e,t),i=this.storage.save();return a>300&&(this.datalist=this.datalist.slice(0,a-10),KISSY.log("add_before\n"+i+"\n"+a),i=this.storage.save(),KISSY.log("add_after\n"+i+"\n"+a)),n}},query:function(e){return this._query(e)},deleteItem:function(e){var t=this._getDatalist(),a=t.length;this._deleteItemByValue(t,encodeURIComponent(e));var r=this.storage.save();a>300&&(this.datalist=this.datalist.slice(0,a-10),r=this.storage.save(),KISSY.log("delete\n"+r+"\n"+a))},clearByDay:function(e){var t=KISSY.now()-24*e*3600*1e3;this._cleanBefore(t),this.storage.save()},hasHistory:function(){return this._getDatalist().length>0?!0:!1}},{ATTRS:{name:{value:"default",setter:function(e){return e}},user:{value:"",setter:function(e){return KISSY.fromUnicode(e)}},maxLength:{value:500},storageType:{value:"flashStorage",setter:function(e){return e},getter:function(e){return e}}}}),e=t}(),c=function(e){function t(e){t.superclass.constructor.call(this,e||{})}var a=d,r=p,n=u;return KISSY.extend(t,a,{pluginInitializer:function(e){var t=this,a=t.get("stat");t.set("caller",e),e.on("beforeSubmit",function(e){var a=e.isInitSearch;t.setStat(a)}),a&&(t.sendTongji(),t.bindSearchTrace())},bindSearchTrace:function(){var e=this;r.delegate("body","click","a",e.initSearchTrace,e)},initSearchTrace:function(e){var t=this,a=e.currentTarget,r=a.getAttribute("trace"),n=a.getAttribute("href");if(r)switch(r){case"relatedSearch":t.saveQuery();break;case"auction":var i=t.stat;i&&-1===n.indexOf("initiative_new")&&a.setAttribute("href",n+"&initiative_new=1")}},sendTongji:function(){var e,t=this,a=t.getStatInst();a.checkFlash({onSuccess:function(){e=a.query("stat")[0],e&&e.value&&(t.stat=e.value,t.send("f_stats_show="+e.value,!0))}})},setStat:function(e,t){var a=this,r=a.get("caller"),n=r.query,i=a.saveQuery(n,e);i&&a.send("lf_aclog=null-null-null-null-0&stats_click="+i,t)},getStatInst:function(){var e=this,t=e.get("caller"),a=t.get("sugConfig"),r=a.tab||"",i=new n({name:"stat",tab:r});return i},saveQuery:function(e,t){var a,r,n=this.getStatInst();return t&&e?(a=encodeURIComponent(e),r="initiative_new:1;q:"+a,n.save("stat",r)):n.deleteItem("stat"),r},send:function(e,t){var a,r;t?(a="/tongji",r="H51884970"):(a="/search",r="H51884969"),(window.goldlog_queue||(window.goldlog_queue=[])).push({action:"goldlog.record",arguments:[a,"",e,r]})},renderPlugin:function(){}},{ATTRS:{pluginId:{value:"stat"}}}),e=t}(),l=function(e){var t=h,a=d,s=m,u=r,l=n,f=o,g=i,p=c,v=(t.all,a.extend({initializer:function(){var e=this;e._initCombo(),e.bindUtil()},bindUtil:function(){var e=this;e.Utils=new g,e.Stat=new p},_setComboCache:function(e){var t=this,a=t.get("tab");t.configArr=t.configArr||[],t.configArr[a]={data:e}},_checkHasTab:function(){var e=this,t=e.getPlugin("tab");t||(e.tabNode=e.get("form"))},_initComboEvent:function(){var e=this,t=e.comboBox,a=t.get("input");a.on("mousedown",function(r){if(e.fire("beforeFocus")!==!1){var n=KISSY.trim(a.val()),i=e.get("sugConfig"),s=!0;s&&(i.autoCollapsed||""===n)&&t.sendRequest(n)}r.stopPropagation()}),a.on("focus",function(){e.fire("beforeFocus")}),a.on("blur",function(){return e.fire("beforeBlur")===!1?!1:void 0});var r=e.get("sugConfig").itemClick,n=!0;if(r&&KISSY.isFunction(r)){n=!1;var i=r.apply(this,arguments);i!==!1&&(n=!0)}n&&t.on("click",e.comboClick,e),t.on("afterCollapsedChange",e._addExtraEvent,e),t.on("afterCollapsedChange",function(t){e.fire("afterCollapsedChange",t)}),t.on("beforeQueryChange",function(t){e.fire("beforeQueryChange",t)}),t.on("beforeSetInputValue",function(){var t=e.get("label");t&&s.hide(t)}),e._formSubmitEvent(),e.query=a.val();var o=e.get("label");o&&o.on("click",function(){t.sendRequest(a.val())})},_formSubmitEvent:function(){var e,t=this,a=t.comboBox,r=a.get("input"),n=r.parent("form"),i=a.get("input");n.on("submit",function(a){t.fire("beforeSubmit",{el:n,isInitSearch:!0})!==!1?(e=n.attr("action"),""===KISSY.trim(i.val())&&t._emptyJump(n)===!1&&a.preventDefault(),t.serializeToForm(n,e)):a.halt()})},serializeToForm:function(e,t){var a,r,n,i="",s="";if(t&&e){if(-1===t.indexOf("?"))return;if(i=t.split("?")[1]){a=i.split("&");for(var o in a)r=a[o].split("="),n=r[0],n&&!e[0][n]&&(s+='<input type="hidden" name="'+r[0]+'" value="'+r[1]+'"/>');e.append(s)}}},_defaultPageJump:function(e){var t,a=this,r=a.tabNode;if(!r)return!1;if(t=e.attr("data-defaultpage")||r.attr("data-defaultpage")){if(!/(http(s:|:))?\/\//.test(t))return!1;e.attr("action",t)}},_emptyJump:function(e){{var t,a=this,r=e.one("label"),n=a.get("sugConfig");n.tab}return r?(t=r.one("span"),t&&""!==t.text()?(r.hide(),void a._holderJump(e,t.text())):a._defaultPageJump(e)):a._defaultPageJump(e)},_holderJump:function(e,t){var a=e[0].q;a&&(a.value=t),e.append('<input type="hidden" name="style" value="grid" />')},_sendSnapshot:function(e){for(var t=this,a=[],r=-1,n=0;n<e.children.length;n++){var i=e.children[n];e.selected==i.value?r=n:a.push(i.value+"/"+i.index)}var s="f_stats_show=xialalist:";s+=a.join(","),s=s+";query:"+e.query,s=s+";selected:"+e.selected+"/"+r,s=s+";time:"+KISSY.now(),s=s+";nick:"+t.getNick(),t.Stat.send(s,!0)},comboClick:function(e){var a,r=this,n=e.target.get?e.target.get("el"):t.one(e.currentTarget),i=r.comboBox,s=n.one(".item-text, .search-menu-key, .search-menu-history-key"),o=!1,u=r.get("form"),c=r.get("sugConfig").isSendByForm;if(s){a=s.text();var l=r.historyArr;if(l)for(var f=0,d=l.length-1;d>=f;f++)if(a===l[f]){o=!0;break}}for(var g=i.get("menu"),p=g.get("children"),h=[],f=0;f<p.length;f++){var m=p[f],v=m.get("value");v&&h.push({index:f,value:v[0]})}var b={query:r.query||"",children:h,selected:a||""};if(r._sendSnapshot(b),r.fire("beforeSubmit",{el:n,isInitSearch:!1,isNotSave:o})!==!1){var y=r.getRedirect(n);c?(r.serializeToForm(u,y),u[0].submit()):r.redirect(y)}},getRedirect:function(e){var t=this,a=(t.comboBox,t.query),r=t.query,n=s.children(e),i=s.attr(n,"data-key")||"q="+a,o=t.get("form")[0],u=s.attr(o,"action"),c=s.attr(n,"data-action")||t.get("action")||u,l=s.attr(n,"data-source-stat")||"source=suggest",f="&_input_charset=utf-8&wq="+encodeURIComponent(r)+"&suggest_query="+encodeURIComponent(a)+"&"+l,d=t._getInputsVal(o);return c+=c.indexOf("?")>-1?"&":"?",c+d+"&"+i+f},redirect:function(e){var t=this,a=t.get("sugConfig").isEncode;a?e=t.urlEncode(e):(e=e.replace(/(#)[^!]/g,function(e,t){return e.replace(t,"%23")}),e=e.replace(/#!/g,"#"));var r=document.createElement("a");r.setAttribute("href",e),r.setAttribute("target","_self"),r.style.display="none",document.body.appendChild(r),r.click()},urlEncode:function(e){var t=/[\u4e00-\u9fa5\uf900-\ufa2d+#\s]+/g.exec(e);if(t)try{e=e.replace("？","?"),e=e.replace(/[\u4e00-\u9fa5\uf900-\ufa2d+#]+/g,function(e){return encodeURIComponent(e)}),e=e.replace(/\s/g,function(e){return"+"}),e+="&ie=utf-8"}catch(a){KISSY.log("url编码出错!")}return e},_getInputsVal:function(e){var t,a,r=this,n=r.get("sugConfig"),i=n.excludeParam,o=[];inputs=s.query("input",e);for(var u=inputs.length-1;u>=0;u--)t=inputs[u],a=t.name,a&&!KISSY.inArray(a,i)&&o.push(a+"="+encodeURIComponent(t.value));return o.length<1?"":"&"+o.join("&")},_getDefComboCfg:function(){return{focused:!1,hasTrigger:!1,matchElWidth:!0,srcNode:".allWidth",highlightMatchItem:!1,menu:{align:{overflow:{adjustY:0}}},cache:!0}},_prepareHtml:function(e){var a=this,r=s.get(e.node),n=r.innerHTML,i=e.prefixCls,o=s.get(e.placeholderEl),u=o?o.outerHTML:"",c='<div class="{cls}combobox"><div class="{cls}combobox-input-wrap"></div></div>',l=c.replace(/{cls}/g,i).replace(/{label}/g,u).replace(/{input}/g,n),f=s.create(l),d={"aria-haspopup":"true","aria-combobox":"list",role:"combobox",autocomplete:"off","class":i+"combobox-input","x-webkit-grammar":"builtin:translate"};return s.attr(r,"aria-label")||(d["aria-label"]=a._isOpen("history")?"请输入搜索文字或从搜索历史中选择":"请输入搜索文字"),s.attr(r,d),s.wrap(r,f),this.get("sugConfig").focused&&s.get(r).focus(),t.one("."+i+"combobox")},_isOpen:function(e){var t=this,a=t.get("mods"),r=a.sort;return KISSY.inArray(e,r)},_getRenderMods:function(){var e=this,t=KISSY.merge(l,e.get("mods"));e.set("mods",t)},_getDataSourceCfg:function(){var e=this,t=e.get("sugConfig"),a=e.get("dataSourceCfg"),r=t.sourceUrl;return location.href.indexOf("debug=test")>-1&&(r=r.replace("suggest.taobao.com/sug?","suggest.proxy.taobao.org/sug?")),-1===r.indexOf("bucketid")&&(r+="&bucketid="+e._getBucketId()),a.xhrCfg.url=r,a.parse=KISSY.bind(e.parse,e),a},_getBucketId:function(){return(new f).getBucket()},_getComboCfg:function(e){var a=this,r=a.get("sugConfig"),n=a._getDefComboCfg(),i=r.prefixCls,s=t.one("."+i+"-combobox");return s||(s=a._prepareHtml(r)),n.srcNode=s,n.dataSource=e,n.format=KISSY.bind(a.format,a),n.prefixCls=r.prefixCls,n.holderEl=t.one(r.placeholderEl),n.maxItemCount=n.maxItemCount||e.maxItemCount,n},_initCombo:function(){var e,t,a=this,r=a._getDataSourceCfg(),n=a.get("sugConfig");a._getRenderMods(),n.sourceUrl?(e=new u.RemoteDataSource(r),e.maxItemCount=10):(e=new u.LocalDataSource(r),e.maxItemCount=0),a._setComboCache(e),t=a._getComboCfg(e);var i=new u(t);i.render(),a.comboBox=i,a._checkHasTab(),a._initComboEvent()},update:function(e){for(var t=this,a=t.get("plugins"),r=0,n=a.length-1;n>=r;r++){var i=a[r];i&&KISSY.isFunction(i.update)&&i.update.call(i,e)}},parse:function(e,t){var a,r=this,n=r.fire("beforeParse",{results:t,query:e});if(n===!1)return[[""]];if(n&&(t=n),!t||!t.result)return KISSY.log("接口无数据!"),[[""]];a=t.result,delete t.result;var i=r.comboBox.get("dataSource");if((i.extraData||(i.extraData=[]))[e]=t,0===a.length)return[[""]];for(var s in a)a[s]||a.splice(s,1);return a},format:function(e,t){var a=this;return a.resultArr=[],a.render(e,t),a.resultArr},render:function(e,t){var a,r,n,i,s,o,u=this,c=u.get("mods"),l=c.sort,f=u._adjustExtra(e,c.showExtra);u.query=e;for(var d=0,g=l.length-1;g>=d;d++)if(o=l[d])if("list"!==o){if(s=u.getPlugin(o),s&&s.renderPlugin)s.renderPlugin({query:e,results:t});else if(r=c[o],r&&f&&(!(i=r.pos)||n!==i)){if(a=r.tmpl,!a)continue;var p=u.resultArr.length,h=u.diffLen||0;n=u.defaultRender({tmpl:a,name:o,pos:i,always:r.always&&t.length>0,callback:r.callback,index:p-h})}}else r=c[o],a=r.tmpl,u._list(e,t,a);u.fire("afterQueryChange",{query:e})},defaultRender:function(e){var t,a=this,r=e.tmpl,n=e.name,i=a.comboBox.get("dataSource"),s=a.query,o=a.get("sugConfig").prefixCls,u=i.extraData,c=e.pos,l=e.index;if(u&&u[s]||e.always){var f,d,g=a._getDate(),p={$query:s,$queryUrl:encodeURIComponent(s),$date:g,prefixCls:o};if(!e.always){if(f=u[s][n],d=!0,!f)return;if(KISSY.isArray(f)){f.length>2&&(f.length=2);for(var h=0,m=f.length-1;m>=h;h++){var v=f[h];if(KISSY.isArray(v)){d=!1;for(var b=0,y=v.length-1;y>=b;b++)p["$"+b]=v[b]||"";p.$index=l+1+h,t=KISSY.substitute(r,p),a.addContent({html:t,query:s,position:c,callback:e.callback})}else p["$"+h]=v,p.$index=l+1+h}return d&&(t=KISSY.substitute(r,p),a.addContent({html:t,query:s,position:c,callback:e.callback})),c}if(KISSY.isObject(f)){for(var S in f)p[n+"_"+S]=f[S];"active"===n&&(p.$query=f.query+" "+f.tag)}else p[n]=f,p.$query=f}return p.$index=l+1,t=KISSY.substitute(r,p),a.addContent({html:t,query:p.$query||s,position:c,callback:e.callback}),c}},_adjustExtra:function(e,t){return""!==e?!0:!1},getNick:function(){var e=this;return e._getCookie("lgc")||e._getCookie("tracknick")},_getCookie:function(e){var t=window;if(t.userCookie&&!KISSY.isUndefined(t.userCookie[e]))return t.userCookie[e];if(t.SRP_COOKIES||(t.SRP_COOKIES={})&&KISSY.isUndefined(SRP_COOKIES[e])){var a=document.cookie.match("(?:^|;)\\s*"+e+"=([^;]*)");SRP_COOKIES[e]=a&&a[1]?decodeURIComponent(a[1]):""}return SRP_COOKIES[e]},_getDate:function(){var e=new Date;return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+(e.getDate()+1)},_list:function(e,t,a){var r,n=this,i=n.get("sugConfig").resultFormat,s=n.resultArr||(n.resultArr=[]);KISSY.each(t,function(n,o){if(!n||!n[0])return void t.splice(o,1);var u,c=n[0],l="",f=e;if(c.match(/<b>/))r=c.replace(/<b>(\S+?)<\/b>/g,function(e,t){return t}),l=c,c="";else{for(;c.indexOf(f)<0;)f=f.substr(0,f.length-1);""===f?(l=c,c=""):0===c.indexOf(f)?(l=f,c=c.replace(f,"")):(l=c,c=""),r=n[0]}for(var d in s)if(u=s[d],u.textContent===n[0]&&u.unique)return;a=a.replace("{format}",i),s.push({textContent:r,content:KISSY.substitute(a,{query:l,text:c,index:o+1,count:n[1],textContent:encodeURIComponent(r)}),list:!0})}),n.resultArr=s},addContent:function(e){var t=this,a=e.html,r=e.position,n=e.query;if(!r){var i=t.resultArr||[];return void i.push({content:a,textContent:n})}t["__"+r]={tmpl:a},t._addExtraEvent()},_renderHeader:function(e,a,r){var n=a&&a.type+"-header"||"";if(a){var i=this.get("sugConfig").prefixCls;e||(e=new t("<div class='"+i+"combobox-menu-header "+n+"'></div>").prependTo(r)),e.empty().append(a.tmpl)}else e&&e.remove()},_renderFooter:function(e,a,r){var n=this,i=n.get("sugConfig").prefixCls,s=a&&a.type+"-footer"||"";if(a){e||(e=new t("<div class='"+i+"combobox-menu-footer "+s+"'></div>").appendTo(r)),a.css&&e.css(a.css),e.empty().append(a.tmpl);var o=e.one("."+i+"menu-history-clean");o&&o.on("click",function(e){e.halt();var t=n.getPlugin("history");t._cleanHistory()})}else e&&e.remove()},_addExtraEvent:function(e){var t=this,a=t.comboBox||t,r=t.__header,n=t.__footer,i=t.__lastHeader,s=t.__lastFooter,o=t.get("sugConfig").prefixCls;if(!e||e&&!e.newVal){var u=a.get("menu");if(!u.get)return;var c=u.get("el");if(!c||c.all("."+o+"menuitem").length<1)return;var l=c.one("."+o+"combobox-menu-header"),f=c.one("."+o+"combobox-menu-footer");i!==r&&(t.__lastHeader=r,t._renderHeader(l,r,c)),s!==n&&(t.__lastFooter=n,t._renderFooter(f,n,c))}else t.__header=null,t.__footer=null}},{ATTRS:{sugConfig:{value:{extraPassParams:"",extraPostParams:"",sourceUrl:"",tab:"item",autoCollapsed:!0,focused:!1,prefixCls:"search-",excludeParam:["q"],resultFormat:"约{count}个宝贝"},setter:function(e){var t=this.get("sugConfig");return KISSY.mix(t,e,void 0,void 0,!0)}},mods:{value:{},setter:function(e){return e}},input:{getter:function(e){return e||(e=this.comboBox.get("input"))}},form:{getter:function(e){return e||(e=this.get("input").parent("form"))}},label:{getter:function(e){return e||(e=this.comboBox.get("holderEl"))}},menu:{getter:function(e){return e||(e=this.comboBox.get("menu"))}},dataSourceCfg:{value:{xhrCfg:{url:"",dataType:"jsonp",scriptCharset:"utf-8",data:{code:"utf-8"}},allowEmpty:!0,paramName:"q",cache:!0}}}}));return e=v}(),a.exports=l});