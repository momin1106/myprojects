KISSY.add("ctr/ct-villager-mgmt/0.0.6/lib/selector",["node","base","io","combobox"],function(e,t,a,i){var n=t("node").all,r=t("base"),l=t("io"),o=t("combobox"),c=KISSY.unparam(location.search.slice(1))._login_daily_,s=c||-1!==location.host.indexOf(".daily."),u=s?"//icuntao.daily.taobao.net":"//icuntao.taobao.com",d='<div class="bd-content"></div><span class="switch"><em>＋</em>新增购买客户</span>',h=r.extend({initializer:function(){this.$el=this.get("$target").append(d),this.render()},render:function(){this.villagerSelector=new o.FilterSelect({render:this.$el.all(".bd-content"),placeholder:"下拉选择购买客户或输入购买客户姓名查找",prefixCls:"ks-villager-mgmt-",width:325,menu:{zIndex:this.get("zIndex")+2},maxItemCount:50,dataSource:new o.LocalDataSource({data:[]}),format:function(e,t){for(var a,i=[],n=0;n<t.length;n++)a=t[n].villagerName+" | "+t[n].villagerMobile,i[n]={content:"<em>"+t[n].villagerName+"</em> | "+t[n].villagerMobile,textContent:a};return i}}).render().on("afterValueChange",function(){this.fire("change")},this),this.getVillagers()},validate:function(){var e;return this.villagerSelector.validate(function(t,a){e=!t}),e},getVillagers:function(){var e=this;return new l({url:u+"/villager/simpleQuery",data:{_output_charset:this.get("charset")},dataType:"jsonp",success:function(t){e.villagerSelector.set("dataSource",new o.LocalDataSource({data:t.result,parse:e._parser}))}})},_parser:function(t,a){var i=[],n=0;return t?(e.each(a,function(e){-1!=(e.villagerName+" | "+e.villagerMobile).indexOf(t)&&i.push(e),n++}),i):a},show:function(){this.$el.show()},hide:function(){this.$el.hide()},destroy:function(){this.villagerSelector.destroy()}},{ATTRS:{$target:{getter:function(e){return n(e)}}}});i.exports=h});