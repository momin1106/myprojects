KISSY.add("kg/search-suggest/6.0.23/plugin/tab",["node","base","dom","event","combobox"],function(t,a,o,e){function r(t){r.superclass.constructor.call(this,t||{})}var s=a("node"),i=a("base"),c=a("dom"),n=a("event"),l=a("combobox");KISSY.extend(r,i,{pluginInitializer:function(t){this.tabConfig={},this._initPluginEvent.call(this,t)},tabClick:function(t){var a,o,e=this,r=e.get("caller"),i=t.currentTarget,n=c.attr(i,"data-searchtype"),l=c.attr(i,"data-defaultpage"),g=c.attr(i,"data-action"),u=r.comboBox.get("input"),f=c.parent(u,"form"),b=e.get("activeCls"),d=c.get("label",f),m=e.tabConfig;if(r.fire("beforeTabChange",{el:i,labelType:n})===!1)return!1;if(c.removeClass(c.siblings(i),b),c.addClass(i,b),r.tabNode=s.one(i),l&&f.setAttribute("data-defaultpage",l),g&&f.setAttribute("action",g),n){if(o=m[n]||e.getDefCfg(n),!o)return!1;g&&(o.action=g),r.update(o),e.tabConfig&&!e.tabConfig[n]&&e.saveTabConfig(o)}else{var C=r.query||u.val(),h=c.get("a",i);if(h){var p=c.attr(h,"href");p=p.replace("/?","/search?"),p=p+"&q="+C,c.attr(h,"href",p)}}d&&(a=d.getAttribute("data-searchtype-"+n)||"",d.innerHTML=a),t.preventDefault()},_initPluginEvent:function(t){var a=this,o=a.get("activeCls"),e=a.get("node")||t.get("sugConfig").tablist;a.set("caller",t),e&&(n.on(e,"click",a.tabClick,a),s.all(e).each(function(a){var e=s.all(a);e.hasClass(o)&&(t.tabNode=e)}),a.saveTabConfig())},saveTabConfig:function(t){var a,o,e=this,r=e.get("caller"),s=r.get("form");a=r.tabNode.attr("data-searchtype"),o=r.userConfig||{},o.mods=r.get("mods"),o.tab=a,o.action=s.attr("action"),o.defaultpage=s.attr("data-defaultpage"),e.tabConfig||(e.tabConfig={}),e.tabConfig[a]=KISSY.clone(o),t&&t.sugConfig&&t.sugConfig.sourceUrl&&e.tabConfig[a].sugConfig&&(e.tabConfig[a].sugConfig.sourceUrl=t.sugConfig.sourceUrl,e.tabConfig[a].tab=a)},update:function(t){var a,o,e,r=this,s=r.get("caller"),i=s.comboBox,n=t.tab,g=s.configArr[n],u=t.sugConfig,f=i.get("input"),b=c.parent(f,"form");s.configArr=s.configArr||[],o=s.get("dataSourceCfg"),e=o.xhrCfg,e.url=u.sourceUrl,s.__attrVals.mods.sort=t.mods.sort,g||(g=""===e.url?s.configArr[n]={data:new l.LocalDataSource({data:{},parse:o.parse})}:s.configArr[n]={data:new l.RemoteDataSource(o)}),a=g.data,i.set("maxItemCount",e.url?10:0),i.set("dataSource",g.data),b&&c.attr(b,"action",t.action),f[0].focus();var d=f.val();d&&i.sendRequest(d)},getDefCfg:function(t){var a;switch(t){case"shop":a={sugConfig:{sourceUrl:location.protocol+"//suggest.taobao.com/sug?area=ssrch&k=1",resultFormat:"",tab:"shop",excludeParam:["q"]},mods:{sort:["history","list"],showExtra:!1},action:location.protocol+"//shopsearch.taobao.com/search",tab:"shop"};break;case"item":a={sugConfig:{sourceUrl:location.protocol+"//suggest.taobao.com/sug?area=c2c&k=1",resultFormat:"",tab:"item",excludeParam:["q"]},mods:{sort:["history","cat","global","list","shop"]},tab:"item",action:location.protocol+"//s.taobao.com/search"};break;case"mall":a={sugConfig:{sourceUrl:location.protocol+"//suggest.taobao.com/sug?area=b2c&k=1",resultFormat:"",tab:"mall",excludeParam:["q"]},mods:{sort:["history","cat","global","list"]},tab:"mall",action:location.protocol+"//list.tmall.com/search_product.htm"};break;default:KISSY.isObject(t)?(a=t,a.sugConfig||(a.sugConfig={})):KISSY.isString(t)&&(a={sugConfig:{sourceUrl:location.protocol+"//suggest.taobao.com/sug?area=c2c&k=1",resultFormat:"",tab:t,excludeParam:["q"]},mods:{sort:["history","list"]},action:null})}return a.sugConfig&&!a.sugConfig.tab&&(a.sugConfig.tab=a.sugConfig.sourceUrl),a}},{ATTRS:{pluginId:{value:"tab"},caller:{value:null}}}),e.exports=r});