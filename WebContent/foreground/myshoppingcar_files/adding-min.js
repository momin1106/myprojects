KISSY.add("ctr/ct-villager-mgmt/0.0.6/lib/adding",["node","base","io","kg/placeholder/2.0.0/index"],function(e,a,t,l){var n=a("node").all,i=a("base"),s=a("io"),r=a("kg/placeholder/2.0.0/index"),d=KISSY.unparam(location.search.slice(1))._login_daily_,c=d||-1!==location.host.indexOf(".daily."),o=c?"//icuntao.daily.taobao.net":"//icuntao.taobao.com";KISSY.config({packages:{"kg/address":{base:"//g.alicdn.com/vip/address",ignorePackageNameInUri:!0}}});var u='<div class="bd-content"><p class="row"><input type="text" class="v_name" placeholder="请输入购买客户姓名" size="30"/></p><p class="row"><input type="text" class="v_mbno" placeholder="请输入购买客户手机号码" size="30"/><span class="warn"></span></p><div class="row J_CitySelect ks-clear clearfix"><input type="hidden" name="prov" value="" class="J_iProv"/><input type="hidden" name="provExt" value="" class="J_iProvExt"/><input type="hidden" name="city" value="" class="J_iCity"/><input type="hidden" name="area" value="" class="J_iArea"/><input type="hidden" name="town" value="" class="J_iTown"/></div><p class="row"><textarea class="v_detail_addr"  placeholder="建议您如实填写详细收货地址，例如街道名称，门牌号码，楼层和房间号等信息"></textarea></p></div><span class="switch"><em>＋</em>已有购买客户</span>',v=i.extend({plugins:[],initializer:function(){var e=this;this.$el=this.get("$target").append(u),KISSY.use(["kg/address/6.0.9/","kg/address/6.0.9/index.css"],function(a,t){e.citySelect=new t({node:e.$el.all(".J_CitySelect")}).on("select",function(){this.fire("change")},e),e.plugins.push(e.citySelect)}),this.$el.all(".v_name, .v_mbno, .v_detail_addr").each(function(a){e.plugins.push(new r({node:a}))}),this.$el.all(".v_mbno,.v_name,  .v_detail_addr").on("valuechange",function(){this.fire("change")},this)},validate:function(){var a=e.some(this.$el.all(".v_name"),function(a){var t=e.trim(a.value);return t.length>10&&(a.value=t.substr(0,10)),e.trim(a.value).length}),t=e.some(this.$el.all(".v_mbno"),function(a){var t=e.trim(a.value),l=t.replace(/[^0-9]/g,"");l.length>11&&(l=l.substr(0,11)),l!==t&&(a.value=l);var i=e.trim(a.value).length;return i&&11>i?n(a).parent().parent().all(".warn").html("请输入11位手机号码").show():n(a).parent().parent().all(".warn").hide(),11===i}),l=e.some(this.$el.all(".v_detail_addr"),function(a){return e.trim(a.value).length>50&&(a.value=e.trim(a.value).substr(0,50)),e.trim(a.value).length});return a&&t&&l&&this.citySelect.getAddressIds().provinceId},addVillager:function(){var a=this.$el.all(".v_name").val(),t=this.$el.all(".v_mbno").val(),l=this.$el.all(".v_detail_addr").val(),n=e.mix({name:a,mobile:t,address:l,_output_charset:this.get("charset")},this.citySelect.getAddressIds());return new s({dataType:"jsonp",url:o+"/villager/addOrEdit",data:n})},show:function(){this.$el.show()},hide:function(){this.$el.hide()},destroy:function(){n(this.plugins).each(function(e,a,t){t[a].destroy()}),this.$el.all(".v_name, .v_mbno, .v_detail_addr").detach("valuechange")}},{ATTRS:{$target:{getter:function(e){return n(e)}}}});l.exports=v});