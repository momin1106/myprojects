KISSY.add("ctr/ct-villager-mgmt/0.0.6/lib/asyncSelector",["node","base","io","combobox"],function(e,t,a,i){var n=t("node").all,l=t("base"),o=(t("io"),t("combobox")),r=KISSY.unparam(location.search.slice(1))._login_daily_,c=r||-1!==location.host.indexOf(".daily."),s=c?"//icuntao.daily.taobao.net":"//icuntao.taobao.com",d='<div class="bd-content"></div><span class="switch"><em>＋</em>新增购买客户</span>',u=o.extend({validate:function(e){var t=this,a=t.get("validator"),i=t.get("value");a?a(i,function(t,a){e(t,i,a)}):e(!1,i,{})}}),g=l.extend({initializer:function(){this.$el=this.get("$target").append(d),this.lastRequestTime=+new Date,this.render()},render:function(){var e=this;this.villagerSelector=new u({render:this.$el.all(".bd-content"),placeholder:"下拉选择购买客户或输入购买客户姓名查找",prefixCls:"ks-villager-mgmt-",width:325,menu:{zIndex:this.get("zIndex")+2},maxItemCount:50,dataSource:new o.RemoteDataSource({xhrCfg:{url:s+"/rest/getSimpleCustomersByKeyword",dataType:"jsonp",data:{}},paramName:"keyword",parse:function(e,t){return t.result},allowEmpty:!0}),format:function(e,t){for(var a,i=[],n=0;n<t.length;n++){var l=t[n].villagerName||t[n].name,o=t[n].villagerMobile||t[n].mobile;a=l+" | "+o,i[n]={content:"<em>"+l+"</em> | "+o,textContent:a}}return i}}),this.villagerSelector.set("validator",function(t,a){var i=!0,n={value:null},l=e.villagerSelector.get("dataSource")&&e.villagerSelector.get("dataSource").get("data")||[];l.forEach(function(e,a){var l=e.villagerName||e.name,o=e.villagerMobile||e.mobile;return l+" | "+o===t?(i=!1,void(n.value=e)):void 0}),a(i,n)}),this.villagerSelector.render().on("afterValueChange",function(){this.fire("change")},this),this.villagerSelector.get("menu").hide()},validate:function(){var e;return this.villagerSelector.validate(function(t,a){e=!t&&a}),e},show:function(){this.$el.show()},hide:function(){this.$el.hide()},destroy:function(){this.villagerSelector.destroy()}},{ATTRS:{$target:{getter:function(e){return n(e)}}}});i.exports=g});